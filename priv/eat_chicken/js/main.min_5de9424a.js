var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function a(t){try{c(i.next(t))}catch(e){r(e)}}function s(t){try{c(i["throw"](t))}catch(e){r(e)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}c((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,r=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(i){n=[6,i],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Board=function(t){function e(e,n){var i=t.call(this)||this;return i.life={full:100,remain:100},i.gold=100,i.playerContainer=new egret.DisplayObjectContainer,i.colorMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],i.createBoard(e,n),i}return __extends(e,t),e.prototype.createBoard=function(t,e){this.cellList=[];for(var n=0;t>n;n++)for(var i=0;e>i;i++){var o=this.createCell(n,i,this.cellList.length);this.addChild(o.getBitmap())}this.addChild(this.playerContainer)},e.prototype.createCell=function(t,e,n){var i=new Cell(t,e,n);return this.cellList.push(i),i},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.getCellList=function(){return this.cellList},e.prototype.putPlayer=function(t){this.playerContainer.addChild(t)},e.prototype.clearPlayers=function(){this.playerContainer.removeChildren()},e.prototype.removePlayer=function(t){this.playerContainer.removeChild(t.getBitmap())},e}(egret.DisplayObjectContainer);__reflect(Board.prototype,"Board");var Cell=function(t){function e(e,n,i){var o=t.call(this)||this;return o.task={action:"idle",target:null,status:null},o.position=new egret.Point(0,0),o.createCell(e,n,i),o}return __extends(e,t),e.prototype.createCell=function(t,e,n){this.id=n,this.cellBitmap=this.createBitmapByName("bg1_jpg"),this.cellBitmap.width=80,this.cellBitmap.height=80,this.position=new egret.Point(this.cellBitmap.width*t,this.cellBitmap.height*e),this.cellBitmap.x=this.position.x,this.cellBitmap.y=this.position.y,this.cellBitmap.touchEnabled=!0,this.cell_X_Y={x:t,y:e}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.getBitmap=function(){return this.cellBitmap},e.prototype.setTask=function(t){this.task=t},e.prototype.getTask=function(){return this.task},e.prototype.getPosition=function(){var t={x:this.cellBitmap.x,y:this.cellBitmap.y};return t},e.prototype.setPosition=function(t){this.cellBitmap.x=t.x,this.cellBitmap.y=t.y},e.prototype.destroy=function(){this.cellBitmap=null},e.prototype.getID=function(){return this.id},e.prototype.getXY=function(){return this.cell_X_Y},e}(egret.DisplayObjectContainer);__reflect(Cell.prototype,"Cell");var House=function(t){function e(e,n){var i=t.call(this)||this;return i.life={full:100,remain:100},i.gold=100,i.colorMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],i.game=n,i.createHouse(e),i}return __extends(e,t),e.prototype.createHouse=function(t){this.name=t.name,this.houseBitmap=this.createBitmapByName(t.bitmap),this.houseBitmap.width=80,this.houseBitmap.height=80,this.houseBitmap.touchEnabled=!0,this.id=this.game.game_id,this.joinEos=this.game.join_eos,this.playerList=[]},e.prototype.createPlayer=function(t,e){var n=new Player(this);return n.setName(t),n.setCellId(e),this.playerList.push(n),n},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.getBitmap=function(){return this.houseBitmap},e.prototype.getPlayerList=function(){return this.playerList},e.prototype.getPosition=function(){var t={x:this.houseBitmap.x,y:this.houseBitmap.y};return t},e.prototype.setPosition=function(t){this.houseBitmap.x=t.x,this.houseBitmap.y=t.y},e.prototype.getLife=function(){return this.life},e.prototype.setLife=function(t){this.life=t},e.prototype.destroy=function(){this.houseBitmap=null,this.playerList=[]},e.prototype.getID=function(){return this.id},e.prototype.setID=function(t){return this.id=t},e.prototype.getJoinEos=function(){return this.joinEos},e.prototype.getGold=function(){return this.gold},e.prototype.setGold=function(t){this.gold=t},e.prototype.getHouseName=function(){return this.name},e.prototype.clearPlayerList=function(){this.playerList=[]},e}(egret.DisplayObjectContainer);__reflect(House.prototype,"House");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e._touchStatus=!1,e._distance=new egret.Point,e.textfield=new egret.TextField,e.tmxTileMap=tiled.TMXTilemap,e._route=new egret.Shape,e._life=new egret.Shape,e.soilderIconList=[],e.houseList=[],e.board=null,e.townRandomName=["johny","kitty","peter"],e.num=0,e.canvas=document.getElementsByTagName("CANVAS")[0],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),t=this,e="resource/desert.tmx",n=new egret.URLLoader,n.dataFormat=egret.URLLoaderDataFormat.TEXT,n.addEventListener(egret.Event.COMPLETE,function(n){var i=egret.XML.parse(n.target.data);this.tmxTileMap=new tiled.TMXTilemap(2e3,2e3,i,e),this.tmxTileMap.render(),t.addChild(this.tmxTileMap),t.createGameScene()},e),n.load(new egret.URLRequest(e)),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return n.sent(),this.stage.removeChild(t),[3,4];case 3:return e=n.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,i,o=this;return __generator(this,function(r){return t=this.createBitmapByName("city_png"),this.stage.addChild(t),t.width=80,t.height=100,t.x=10,t.y=5,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.createGame.bind(this,{name:"johny",bitmap:"house_png"}),this),e=this.createBitmapByName("bg1_jpg"),this.stage.addChild(e),e.x=10,e.y=115,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setMap,this),n=this.createBitmapByName("soilder_png"),this.stage.addChild(n),n.x=10,n.y=200,n.width=55,n.height=80,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.joinGame,this),i=this.createBitmapByName("recall_png"),this.stage.addChild(i),i.x=10,i.y=300,i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.kickOff,this),this.login=this.createBitmapByName("login_png"),this.login.x=1150,this.login.y=10,this.login.touchEnabled=!0,this.login.addEventListener(egret.TouchEvent.TOUCH_TAP,this.loginGame,this),this.logout=this.createBitmapByName("logout_png"),this.logout.x=1150,this.logout.y=10,this.logout.touchEnabled=!0,this.logout.addEventListener(egret.TouchEvent.TOUCH_TAP,this.logoutGame,this),ScatterUtils.getIdentiy().then(function(t){null==t?o.stage.addChild(o.login):(ScatterUtils.login(),o.stage.addChild(o.logout))}),this.stage.addChild(this.textfield),this.refreshHouseList(),[2]})})},e.prototype.initBoard=function(){return __awaiter(this,void 0,void 0,function(){var t,e=this;return __generator(this,function(n){return null==this.board&&(this.board=new Board(11,11),this.board.x=180,this.board.y=110,this.stage.addChild(this.board),t=this.board.getCellList(),t.map(function(t){var n=t.getBitmap(),i=t.getXY();n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.move(i.x,i.y,t.getPosition())},e)})),[2]})})},e.prototype.updatePlayersInBoard=function(t){return __awaiter(this,void 0,void 0,function(){var e,n=this;return __generator(this,function(i){return e=new LoadingUI,this.board.addChild(e),ScatterUtils.getGameInfo(t).then(function(t){if(n.board.removeChild(e),n.board.clearPlayers(),n.selectedHouse.clearPlayerList(),console.log("game info",t),t.rows.length>0){var i=t.rows[0].players;i.map(function(t,e){n.createPlayer(t)})}else alert("无玩家")})["catch"](function(t){console.error(t),alert("获取游戏信息失败："+t)}),[2]})})},e.prototype.refreshHouseList=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,ScatterUtils.getAllGamesInfo().then(function(e){t.houseList.map(function(e){t.stage.contains(e.getBitmap())&&(t.stage.removeChild(e.getBitmap()),e.destroy())}),console.log(e),e.rows.map(function(e,n){console.log(e),t.createHouse({name:"johny",bitmap:"house_png"},e).then(function(e){console.log(e),e.setPosition(new egret.Point(100*(1+n),5)),t.houseList.push(e)})})})["catch"](function(t){console.error(t),alert("获取游戏信息失败")})];case 1:return e.sent(),[2]}})})},e.prototype.createGame=function(){var t=this;ScatterUtils.getIdentiy().then(function(e){return null==e?void alert(ScatterUtils.message.authority):void ScatterUtils.createGame("1.0000 EOS").then(function(e){console.log("create",e),e.processed?t.refreshHouseList():(e=JSON.parse(e),alert("创建游戏失败:"+e.error.details[0].message))})["catch"](function(t){console.log(t),alert("取消创建游戏")})})},e.prototype.joinGame=function(){var t=this;ScatterUtils.getIdentiy().then(function(e){return null==e?void alert(ScatterUtils.message.authority):t.selectedHouse?void ScatterUtils.joinGame(t.selectedHouse.getID(),t.selectedHouse.getJoinEos(),10,10).then(function(t){console.log("transaction",t),t.processed?alert("加入游戏！"):(t=JSON.parse(t),alert("加入游戏失败:"+t.error.details[0].message))})["catch"](function(t){console.error(t),alert("加入游戏失败:"+t)}):(console.log("no house selected"),void alert("请选择加入的游戏房间"))})},e.prototype.setMap=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return ScatterUtils.getIdentiy().then(function(e){return null==e?void alert(ScatterUtils.message.authority):t.selectedHouse?void ScatterUtils.setMap(t.selectedHouse.getID()).then(function(t){console.log("result",t),1==t.succ?alert("棋盘地图设定成功！"):alert("棋盘地图已经设定")}):(console.log("no house selected"),void alert("请选择设定棋盘的游戏房间"))}),[2]})})},e.prototype.move=function(t,e,n){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(o){return ScatterUtils.getIdentiy().then(function(o){if(null==o)return void alert(ScatterUtils.message.authority);var r=i.selectedHouse.getID();ScatterUtils.move(r,t,e).then(function(t){return __awaiter(i,void 0,void 0,function(){var e,i,o;return __generator(this,function(a){switch(a.label){case 0:return console.log("move transaction",t),t.processed?[3,1]:(t=JSON.parse(t),alert("移动失败："+t.error.details[0].message),[3,3]);case 1:return[4,ScatterUtils.getCurrentAccountName()];case 2:e=a.sent(),console.log("name",e),console.log("this.selectedHouse",this.selectedHouse),i=this.selectedHouse.getPlayerList().filter(function(t){return t.getName()==e}),console.log("currentPlayer",i),i.length>0?(o=i[0].getBitmap(),egret.Tween.get(o).to(n,1e3,egret.Ease.sineIn).wait(0).call(this.updatePlayersInBoard.bind(this,r)).wait(500).call(this.checkCell.bind(this,i[0]))):this.updatePlayersInBoard(r),a.label=3;case 3:return[2]}})})})["catch"](function(t){console.error(t),alert("移动失败")})}),[2]})})},e.prototype.checkCell=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(i){switch(i.label){case 0:return e=this.selectedHouse.getPlayerList().filter(function(e){return e.getName()==t.getName()}),[4,this.selectedHouse.getPlayerList().filter(function(t){return t.getCellId()==e[0].getCellId()})];case 1:return n=i.sent(),console.log("encounter",n),n.length>1&&this.attackTarget(t.getPosition(),t),[2]}})})},e.prototype.kickOff=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return ScatterUtils.getIdentiy().then(function(e){return null==e?void alert(ScatterUtils.message.authority):t.selectedHouse?void ScatterUtils.kickOff(t.selectedHouse.getID()).then(function(e){console.log(e),e.processed?(alert("游戏 Kick Off！"),t.refreshHouseList(),t.initBoard().then(function(){t.updatePlayersInBoard(t.selectedHouse.getID())})):(e=JSON.parse(e),alert("KickOff游戏失败："+e.error.details[0].message))}):(console.log("no house selected"),void alert("请选择Kick Off的游戏房间"))}),[2]})})},e.prototype.createHouse=function(t,e){return __awaiter(this,void 0,void 0,function(){var n,i,o=this;return __generator(this,function(r){return t.name=this.townRandomName[this.num],this.num=this.num<2?this.num+1:this.num-1,n=new House(t,e),i=n.getBitmap(),this.stage.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.selectedHouse==n,o.selectedHouse=n,o.showLife(o.stage,n),o.showText(e.game_id+"号房:"+(2==e.game_progress?"已开局":"未开局"),{x:i.x,y:i.y+80}),o.initBoard().then(function(){o.updatePlayersInBoard(e.game_id)})},this),[2,n]})})},e.prototype.createPlayer=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,i,o,r,a,s,c=this;return __generator(this,function(u){switch(u.label){case 0:return this.selectedHouse?(e=t.cell_id,n=this.selectedHouse.createPlayer(t.acc_name,e),[4,this.board.getCellList().filter(function(t){return t.getID()==e})]):(console.log("no town selected"),[2]);case 1:return i=u.sent(),o=i[0].getPosition(),r=o.x,a=o.y,n.setPosition(new egret.Point(r,a)),s=n.getBitmap(),this.board.putPlayer(s),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.showLife(c.board,n)},this),[2]}})})},e.prototype.loginGame=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return ScatterUtils.connect().then(function(t){return t?void 0:void alert("亲，还没有装钱包哟")}),ScatterUtils.login().then(function(e){e.login?(alert("欢迎: "+e.details),t.stage.contains(t.login)&&t.stage.removeChild(t.login),t.stage.contains(t.logout)||t.stage.addChild(t.logout)):alert(e.details)})["catch"](function(t){console.log("e",t),alert(t)}),[2]})})},e.prototype.logoutGame=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return ScatterUtils.logout().then(function(e){ScatterUtils.getCurrentAccountName().then(function(n){alert(e.details),e.logout&&(t.stage.contains(t.logout)&&t.stage.removeChild(t.logout),t.stage.contains(t.login)||t.stage.addChild(t.login))})})["catch"](function(t){console.log("e",t),alert(t)}),[2]})})},e.prototype.recall=function(t){if(t||(t=this.selectedPlayer),t){this.unmountMovement(),this.clearRoute(t.getTask().action);var e=t.getTask().status,n=t.getHouse(),i=n.getPosition(),o=t.getBitmap();egret.Tween.removeTweens(o),e&&"completed"==e?egret.Tween.get(o).to(i,1e3,egret.Ease.sineIn):egret.Tween.get(o).to(i,0,egret.Ease.sineIn),t.setTask({action:"idle",target:null,status:null})}},e.prototype.initTask=function(t){var e=this;this.selectedPlayer?(this.unmountMovement(),this.selectedPlayer.setTask({action:t,target:null,status:null}),setTimeout(function(){e.mountMovement()},300)):console.log("no warrior selected")},e.prototype.showLife=function(t,e){var n,i=e.getLife();n=i.remain>=.6*i.full?60928:i.remain>=.4*i.full&&i.remain<.6*i.full?16776960:16711680,this._life.graphics.clear(),this._life.graphics.lineStyle(4,n),this._life.graphics.moveTo(e.getPosition().x,e.getPosition().y),this._life.graphics.lineTo(e.getPosition().x+i.remain,e.getPosition().y),t.addChild(this._life)},e.prototype.showText=function(t,e){this.textfield.x=e.x,this.textfield.y=e.y,this.textfield.size=22,this.textfield.textColor=0,this.textfield.text=t},e.prototype.selectPlayer=function(t){var e=this;this.unmountMovement();var n=t.getHouse()==this.selectedHouse?!0:!1;if(!n){var i=t.getTask();"enforce"==i.action&&i.target==this.selectedHouse&&(n=!0)}n&&(this.selectedPlayer=t,this.stage.setChildIndex(this.selectedPlayer.getBitmap(),10),this.showLife(this.board,t),this.actionSound(RES.getRes("ack_mp3").url)),setTimeout(function(){e.mountMovement()},300)},e.prototype.actionSound=function(t){var e=new egret.Sound;e.addEventListener(egret.Event.COMPLETE,function(t){e.play(0,1)},this),e.load(t)},e.prototype.movePlayer=function(t){if(console.log("moving"),null!=this.selectedPlayer&&"undefined"!=typeof this.selectedPlayer){this.stage.contains(this._life)&&this.stage.removeChild(this._life);var e=this.selectedPlayer.getBitmap();egret.Tween.removeTweens(e);var n={x:e.x,y:e.y},i={x:t.stageX,y:t.stageY},o=this.selectedPlayer.getTask().action;this.drawRoute(n,i,o);var r={x:t.stageX-17,y:t.stageY-25};egret.Tween.get(e).to(r,3e3,egret.Ease.sineIn).wait(500).call(this.doAction.bind(this,this.selectedPlayer,o,r,i))}},e.prototype.mountMovement=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.movePlayer,this)},e.prototype.unmountMovement=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.movePlayer,this)},e.prototype.doAction=function(t,e,n,i){var o=this;this.clearRoute(e);var r=t.getTask().target,a=null==r||null==r.getBitmap()?!1:r.getBitmap().hitTestPoint(i.x,i.y,!0);if(console.log("execute="+a),a){var s=this.createBitmapByName("sword_png");s.x=n.x,s.y=n.y,this.stage.addChild(s),"attack"==e?this.attackTarget(n,r).then(function(){t.setTask({action:"attack",target:null,status:"completed"}),o.recall(t)}):t.setTask({action:"enforce",target:r,status:"completed"}),setTimeout(function(){o.stage.removeChild(s),s=null},1e3)}else t.setTask({action:"idle",target:null})},e.prototype.attackTarget=function(t,e){var n=this,i=this.createBitmapByName("sword_png");i.x=t.x,i.y=t.y,this.board.addChild(i);var o=new egret.MovieClipDataFactory(RES.getRes("fight_json"),RES.getRes("fight_png")),r=new egret.MovieClip(o.generateMovieClipData("fight"));r.x=t.x,r.y=t.y,r.width=50,r.height=50,this.board.addChild(r),r.play(4),this.actionSound(RES.getRes("fighting_mp3").url);var a=e.getLife();a.remain=a.remain-.2*a.full,e.setLife(a),this.showLife(this.board,e);var s=(e.getGold(),new egret.MovieClipDataFactory(RES.getRes("money_json"),RES.getRes("money_png"))),c=new egret.MovieClip(s.generateMovieClipData("money"));return c.x=t.x,c.y=t.y-30,this.board.addChild(c),c.play(2),this.actionSound(RES.getRes("destroyhuman_wav").url),setTimeout(function(){n.board.removeChild(c)},2e3),new Promise(function(t,e){setTimeout(function(){n.board.removeChild(r),n.board.removeChild(i),n.board.contains(n._life)&&n.board.removeChild(n._life),t()},1e3)})},e.prototype.drawRoute=function(t,e,n){this.clearRoute(n);var i,o,r;switch(n){case"attack":i=16711680,o=25,r=25;break;case"enforce":i=60928,o=10,r=50;break;default:i=16776960,o=10,r=50}this._route.graphics.lineStyle(2,i),this._route.graphics.moveTo(t.x,t.y),this._route.graphics.lineTo(e.x,e.y),this[n].x=e.x-o,this[n].y=e.y-r,this.stage.addChild(this[n])},e.prototype.clearRoute=function(t){this._route.graphics.clear(),this.stage.contains(this[t])&&this.stage.removeChild(this[t]),this.stage.contains(this._life)&&this.stage.removeChild(this._life)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.mouseDown=function(t){this._touchStatus=!0,this._distance.x=t.stageX-t.target.x,this._distance.y=t.stageY-t.target.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.mouseMove=function(t){if(this._touchStatus)try{t.target.x=t.stageX-this._distance.x,t.target.y=t.stageY-this._distance.y}catch(e){console.log(e)}},e.prototype.mouseUp=function(t){this._touchStatus=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.removePlayerIcon=function(t){var e=this,n=t.getUUID();this.soilderIconList.map(function(t,i){t.key==n&&(e.stage.contains(t.icon)&&e.stage.removeChild(t.icon),e.soilderIconList.splice(i,1))})},e.prototype.refrashPlayerIcon=function(){this.soilderIconList.map(function(t,e){t.icon.x=110+68*e})},e.prototype.startAnimation=function(t){var e=this,n=new egret.HtmlTextParser,i=t.map(function(t){return n.parse(t)}),o=this.textfield,r=-1,a=function(){r++,r>=i.length&&(r=0);var t=i[r];o.textFlow=t;var n=egret.Tween.get(o);n.to({alpha:1},200),n.wait(2e3),n.to({alpha:0},200),n.call(a,e)};a()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Player=function(t){function e(e){var n=t.call(this)||this;return n.task={action:"idle",target:null,status:null},n.position=new egret.Point(0,0),n.life={full:40,remain:40},n.gold=5,n.createPlayer(e),n}return __extends(e,t),e.prototype.createPlayer=function(t){this.playerBitmap=this.createBitmapByName(t.name+"_soilder_png"),this.playerBitmap.width=48,this.playerBitmap.height=70,this.playerBitmap.x=this.position.x,this.playerBitmap.y=this.position.y,this.playerBitmap.touchEnabled=!0,this.house=t,this.uuid=(new Date).getTime()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.getBitmap=function(){return this.playerBitmap},e.prototype.setTask=function(t){this.task=t},e.prototype.getTask=function(){return this.task},e.prototype.getHouse=function(){return this.house},e.prototype.getPosition=function(){var t={x:this.playerBitmap.x,y:this.playerBitmap.y};return t},e.prototype.setPosition=function(t){this.playerBitmap.x=t.x,this.playerBitmap.y=t.y},e.prototype.getName=function(){return this.accName},e.prototype.setName=function(t){this.accName=t},e.prototype.getLife=function(){return this.life},e.prototype.setLife=function(t){this.life=t},e.prototype.destroy=function(){this.playerBitmap=null},e.prototype.getUUID=function(){return this.uuid},e.prototype.getGold=function(){return this.gold},e.prototype.setGold=function(t){this.gold=t},e.prototype.getCellId=function(){return this.cell_id},e.prototype.setCellId=function(t){this.cell_id=t},e}(egret.DisplayObjectContainer);__reflect(Player.prototype,"Player");var ScatterUtils=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.getEOS=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return null==this.eos?[2,Eos(this.config)]:[2,this.eos]})})},e.connect=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=this,[4,ScatterJS.scatter.connect("scatter")];case 1:return t.connected=e.sent(),[2,this.connected]}})})},e.login=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n=this;return __generator(this,function(i){switch(i.label){case 0:return[4,this.connect()];case 1:if(i.sent(),!this.connected)return console.log("not connected"),[2,{login:!1,details:this.message.nowallet}];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,ScatterJS.scatter.getIdentity({accounts:[this.network.EOS]}).then(function(t){return console.log("identities",t,ScatterJS.scatter.identity),n.currentAccount=t.accounts[0],n.eos=ScatterJS.scatter.eos(n.network.EOS,Eos),{login:!0,details:n.currentAccount.name}})];case 3:return t=i.sent(),[2,t];case 4:return e=i.sent(),[2,{login:!1,details:this.message.walletlock}];case 5:return[2]}})})},e.getAccountInfo=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return null!=this.eos?[3,2]:(t=this,[4,this.getEOS()]);case 1:t.eos=n.sent(),n.label=2;case 2:return[4,this.eos.getAccount(this.currentAccount.name).then(function(t){return console.log(t),t})["catch"](function(t){return t})];case 3:return e=n.sent(),[2,e]}})})},e.getAllGamesInfo=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return null!=this.eos?[3,2]:(t=this,[4,this.getEOS()]);case 1:t.eos=n.sent(),n.label=2;case 2:return[4,this.eos.getTableRows({json:!0,scope:"eat.chicken",code:"eat.chicken",table:"games"}).then(function(t){return console.log(t),t})["catch"](function(t){return t})];case 3:return e=n.sent(),[2,e]}})})},e.getGameInfo=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(i){switch(i.label){case 0:return null!=this.eos?[3,2]:(e=this,[4,this.getEOS()]);case 1:e.eos=i.sent(),i.label=2;case 2:return[4,this.eos.getTableRows({json:!0,scope:"eat.chicken",code:"eat.chicken",table:"games",limit:1,lower_bound:t,upper_bound:t+1}).then(function(t){return t})["catch"](function(t){return t})];case 3:return n=i.sent(),[2,n]}})})},e.createGame=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return[4,this.eos.transaction({actions:[{account:"eosio.token",name:"transfer",authorization:[{actor:this.currentAccount.name,permission:"active"}],data:{from:this.currentAccount.name,to:"eat.chicken",quantity:t,memo:""}}]}).then(function(t){return t})["catch"](function(t){return t})];case 1:return e=n.sent(),[2,e]}})})},e.joinGame=function(t,e,n,i){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(r){switch(r.label){case 0:return[4,this.eos.transaction({actions:[{account:"eosio.token",name:"transfer",authorization:[{actor:this.currentAccount.name,permission:"active"}],data:{from:this.currentAccount.name,to:"eat.chicken",quantity:e,memo:t+","+n+","+i}}]}).then(function(t){return console.log("res",t),t})["catch"](function(t){return t})];case 1:return o=r.sent(),[2,o]}})})},e.setMap=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return[4,fetch("http://114.115.135.201:52919/api?a=setmap&game_id="+t,{method:"GET"}).then(function(t){return t.json()}).then(function(t){return console.log(t),t})];case 1:return e=n.sent(),[2,e]}})})},e.kickOff=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return[4,this.eos.transaction({actions:[{account:"eat.chicken",name:"kickoff",authorization:[{actor:this.currentAccount.name,permission:"active"}],data:{who:this.currentAccount.name,game_id:t}}]}).then(function(t){return t})["catch"](function(t){return t})];case 1:return e=n.sent(),[2,e]}})})},e.move=function(t,e,n){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return[4,this.eos.transaction({actions:[{account:"eat.chicken",name:"move",authorization:[{actor:this.currentAccount.name,permission:"active"}],data:{who:this.currentAccount.name,game_id:t,row:e,column:n}}]}).then(function(t){return t})["catch"](function(t){return t})];case 1:return i=o.sent(),[2,i]}})})},e.logout=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){try{return ScatterJS.scatter.forgetIdentity(),this.currentAccount=null,this.eos=null,[2,{logout:!0,details:this.message.logout}]}catch(e){return console.log(e),[2,{logout:!1,details:"登出失败"}]}return[2]})})},e.getCurrentAccountName=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return null!=this.currentAccount?[2,this.currentAccount.name]:[2,null]})})},e.getIdentiy=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,ScatterJS.scatter.identity]})})},e.eos=null,e.connected=!1,e.currentAccount=null,e.message={authority:"未授权用户，请先登录",walletlock:"钱包已上锁",identity:"钱包还没有身份",nowallet:"还没有安装钱包",login:"已登陆",logout:"已登出"},e.chain={main:"aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906",jungle:"038f4b0fc8ff18a4f0842a8f0564611f6e96e8535901dd45e43ac8691a1c4dca",dev:"cf057bbfb72640471fd910bcb67639c22df9f92470936cddc1ade0e2f2e7dc4f"},e.Blockchains={EOSIO:"eos",Ethereum:"eth",Tron:"trx"},e.network={EOS:{blockchain:"eos",protocol:"http",host:"114.115.135.201",port:8888,chainId:e.chain.dev},ETH:{blockchain:"eth",protocol:"http",host:"114.115.135.201",port:8888,chainId:e.chain.dev},TRX:{blockchain:"trx",protocol:"http",host:"114.115.135.201",port:8888,chainId:e.chain.dev}},e.config={keyProvider:["5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3","5KRF8dr2fvHx9dVQyBqWwYhs7KvT8UdCb8Fy6hpWqHp6yZ1K6T3"],httpEndpoint:"http://114.115.135.201:8888",chainId:e.chain.dev,expireInSeconds:60,broadcast:!0,debug:!1,sign:!0},e}(Object);__reflect(ScatterUtils.prototype,"ScatterUtils");