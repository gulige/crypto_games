var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))(function(n,o){function s(e){try{l(a.next(e))}catch(t){o(t)}}function r(e){try{l(a["throw"](e))}catch(t){o(t)}}function l(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(s,r)}l((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return a([e,t])}}function a(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){l.label=i[1];break}if(6===i[0]&&l.label<s[1]){l.label=s[1],s=i;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(i);break}s[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(a){i=[6,a],o=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,o,s,r,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},Main=function(e){function t(){var t=e.call(this)||this;return t.gameContainer=new egret.DisplayObjectContainer,t._touchStatus=!1,t._distance=new egret.Point,t.textfield=new egret.TextField,t.tmxTileMap=tiled.TMXTilemap,t._route=new egret.Shape,t._life=new egret.Shape,t.soilderIconList=[],t.eos_one=[],t.eos_three=[],t.eos_five=[],t.board=null,t.login=new egret.Shape,t.logout=new egret.Shape,t.identityText=new egret.TextField,t.backgroundMusic=new egret.Sound,t.playerInfo=new egret.Shape,t.player_name=new egret.TextField,t.player_hp=new egret.TextField,t.player_attack=new egret.TextField,t.player_defense=new egret.TextField,t.player_eos=new egret.TextField,t.player_item=new egret.TextField,t.player_weapon=new egret.TextField,t.messageContainer=new egret.DisplayObjectContainer,t.messageBox=new egret.Shape,t.message=new egret.TextField,t.messageTitle=new egret.TextField,t.descriptionContainer=new egret.DisplayObjectContainer,t.descriptionBox=new egret.Shape,t.description=new egret.TextField,t.descriptionTitle=new egret.TextField,t.townRandomName=["johny","kitty","peter"],t.num=0,t.oneEosContainer=new egret.DisplayObjectContainer,t.threeEosContainer=new egret.DisplayObjectContainer,t.fiveEosContainer=new egret.DisplayObjectContainer,t.messageTimeout=null,t.mobile=!1,t.touchPoints={names:[]},t.distance=0,t.touchCon=0,t.lastPositionX=0,t.lastPositionY=0,t.canvas=document.getElementsByTagName("CANVAS")[0],t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return LocaleUtils.locale=null==localStorage.getItem("eatchicken_locale")?"zh_CN":localStorage.getItem("eatchicken_locale").toString(),this.createGameScene(),[2]})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return i.sent(),this.stage.removeChild(e),[3,4];case 3:return t=i.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,a,n,o,s,r,l,c,h,g,u,d,p,m,y,f,_,C,v,w,x,b,L,T,B,U,S,I,P=this;return __generator(this,function(E){switch(E.label){case 0:return[4,this.loadResource()];case 1:return E.sent(),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this),this.stage.addChild(this.gameContainer),e=this.createBitmapByName("EOS_1_png"),this.gameContainer.addChild(e),e.width=100,e.height=100,e.x=15,e.y=70,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.createGame.bind(this,"1.0000"),this),t=new egret.Shape,t.graphics.beginFill(60928),t.graphics.lineStyle(2,0),t.graphics.drawRoundRect(15,180,100,30,15,15),t.graphics.endFill(),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.filterAndUpdateGameList.bind(this,1,-1,"game_png",this.oneEosContainer),this),this.gameContainer.addChild(t),i=new egret.TextField,i.x=35,i.y=185,i.size=18,i.textColor=0,i.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.all"),this.gameContainer.addChild(i),a=new egret.Shape,a.graphics.beginFill(60928),a.graphics.lineStyle(2,0),a.graphics.drawRoundRect(15,220,100,30,15,15),a.graphics.endFill(),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.filterAndUpdateGameList.bind(this,1,1,"game_png",this.oneEosContainer),this),this.gameContainer.addChild(a),n=new egret.TextField,n.x=18,n.y=225,n.size=18,n.textColor=0,n.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.joinable"),this.gameContainer.addChild(n),o=new egret.Shape,o.graphics.beginFill(16776960),o.graphics.lineStyle(2,0),o.graphics.drawRoundRect(15,260,100,30,15,15),o.graphics.endFill(),o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.filterAndUpdateGameList.bind(this,1,2,"game_png",this.oneEosContainer),this),this.gameContainer.addChild(o),s=new egret.TextField,s.x=18,s.y=265,s.size=18,s.textColor=0,s.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.ongoing"),this.gameContainer.addChild(s),r=this.createBitmapByName("EOS_3_png"),this.gameContainer.addChild(r),r.width=100,r.height=100,r.x=15,r.y=390,r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.createGame.bind(this,"3.0000"),this),l=new egret.Shape,l.graphics.beginFill(60928),l.graphics.lineStyle(2,0),l.graphics.drawRoundRect(15,500,100,30,15,15),l.graphics.endFill(),l.touchEnabled=!0,l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.filterAndUpdateGameList.bind(this,3,-1,"game_1_png",this.threeEosContainer),this),this.gameContainer.addChild(l),c=new egret.TextField,c.x=35,c.y=505,c.size=18,c.textColor=0,c.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.all"),this.gameContainer.addChild(c),h=new egret.Shape,h.graphics.beginFill(60928),h.graphics.lineStyle(2,0),h.graphics.drawRoundRect(15,540,100,30,15,15),h.graphics.endFill(),h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.filterAndUpdateGameList.bind(this,3,1,"game_1_png",this.threeEosContainer),this),this.gameContainer.addChild(h),g=new egret.TextField,g.x=18,g.y=545,g.size=18,g.textColor=0,g.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.joinable"),this.gameContainer.addChild(g),u=new egret.Shape,u.graphics.beginFill(16776960),u.graphics.lineStyle(2,0),u.graphics.drawRoundRect(15,580,100,30,15,15),u.graphics.endFill(),u.touchEnabled=!0,u.addEventListener(egret.TouchEvent.TOUCH_TAP,this.filterAndUpdateGameList.bind(this,3,2,"game_1_png",this.threeEosContainer),this),this.gameContainer.addChild(u),d=new egret.TextField,d.x=18,d.y=585,d.size=18,d.textColor=0,d.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.ongoing"),this.gameContainer.addChild(d),p=this.createBitmapByName("EOS_5_png"),this.gameContainer.addChild(p),p.width=100,p.height=100,p.x=15,p.y=700,p.touchEnabled=!0,p.addEventListener(egret.TouchEvent.TOUCH_TAP,this.createGame.bind(this,"5.0000"),this),m=new egret.Shape,m.graphics.beginFill(60928),m.graphics.lineStyle(2,0),m.graphics.drawRoundRect(15,810,100,30,15,15),m.graphics.endFill(),m.touchEnabled=!0,m.addEventListener(egret.TouchEvent.TOUCH_TAP,this.filterAndUpdateGameList.bind(this,5,-1,"game_2_png",this.fiveEosContainer),this),this.gameContainer.addChild(m),y=new egret.TextField,y.x=35,y.y=815,y.size=18,y.textColor=0,y.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.all"),this.gameContainer.addChild(y),f=new egret.Shape,f.graphics.beginFill(60928),f.graphics.lineStyle(2,0),f.graphics.drawRoundRect(15,850,100,30,15,15),f.graphics.endFill(),f.touchEnabled=!0,f.addEventListener(egret.TouchEvent.TOUCH_TAP,this.filterAndUpdateGameList.bind(this,5,1,"game_2_png",this.fiveEosContainer),this),this.gameContainer.addChild(f),_=new egret.TextField,_.x=18,_.y=855,_.size=18,_.textColor=0,_.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.joinable"),this.gameContainer.addChild(_),C=new egret.Shape,C.graphics.beginFill(16776960),C.graphics.lineStyle(2,0),C.graphics.drawRoundRect(15,890,100,30,15,15),C.graphics.endFill(),C.touchEnabled=!0,C.addEventListener(egret.TouchEvent.TOUCH_TAP,this.filterAndUpdateGameList.bind(this,5,2,"game_2_png",this.fiveEosContainer),this),this.gameContainer.addChild(C),v=new egret.TextField,v.x=18,v.y=895,v.size=18,v.textColor=0,v.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.ongoing"),this.gameContainer.addChild(v),this.login.graphics.beginFill(60928),this.login.graphics.lineStyle(2,0),this.login.graphics.drawRoundRect(1180,10,100,50,15,15),this.login.graphics.endFill(),this.login.touchEnabled=!0,this.login.addEventListener(egret.TouchEvent.TOUCH_TAP,this.loginGame,this),this.logout.graphics.beginFill(16776960),this.logout.graphics.lineStyle(2,0),this.logout.graphics.drawRoundRect(1180,10,100,50,15,15),this.logout.graphics.endFill(),this.logout.touchEnabled=!0,this.logout.addEventListener(egret.TouchEvent.TOUCH_TAP,this.logoutGame,this),ScatterUtils.getIdentity().then(function(e){null==e?(P.gameContainer.addChild(P.login),P.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.login")):(ScatterUtils.login(),P.gameContainer.addChild(P.logout),P.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.logout")),P.identityText.x=1190,P.identityText.y=22,P.identityText.size=25,P.identityText.textColor=0,P.gameContainer.addChild(P.identityText)}),this.messageContainer.x=600,this.messageContainer.y=200,this.messageContainer.width=350,this.messageContainer.height=250,this.messageBox.graphics.clear(),this.messageBox.graphics.beginFill(16240036,.8),this.messageBox.graphics.lineStyle(2,0,.5),this.messageBox.graphics.drawRoundRect(0,0,350,250,15,15),this.messageBox.graphics.endFill(),this.messageContainer.addChild(this.messageBox),w=new egret.Shape,w.graphics.beginFill(5197647,.8),w.graphics.drawRoundRect(0,0,350,30,15,15),this.messageContainer.addChild(w),this.messageTitle.x=145,this.messageTitle.y=3,this.messageTitle.size=20,this.messageTitle.textColor=16777215,this.messageTitle.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.notice.bar.title"),this.messageContainer.addChild(this.messageTitle),this.message.x=10,this.message.y=35,this.message.width=330,this.message.height=200,this.message.size=20,this.message.textColor=0,this.message.$setWordWrap(!0),this.message.$setMultiline(!0),this.messageContainer.addChild(this.message),x=this.createBitmapByName("description_png"),this.gameContainer.addChild(x),x.x=1310,x.y=10,x.width=110,x.touchEnabled=!0,x.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){P.gameContainer.addChild(P.descriptionContainer)},this),b=new egret.TextField,b.x=1315,b.y=25,b.size=20,b.textColor=1842204,b.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.desc.caption"),this.gameContainer.addChild(b),L=new egret.DisplayObjectContainer,L.x=1435,L.y=13,L.touchEnabled=!0,this.gameContainer.addChild(L),T=new egret.Shape,T.graphics.clear(),T.graphics.beginFill(16240036),T.graphics.lineStyle(2,0,.5),T.graphics.drawRect(0,0,60,40),T.graphics.endFill(),L.addChild(T),B=new egret.TextField,B.x=10,B.y=10,B.size=20,B.textColor=4471354,B.text=LocaleUtils.getLabelById("zh_CN"==LocaleUtils.locale?"en_US":"zh_CN","locale"),L.addChild(B),L.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"zh_CN"==LocaleUtils.locale?(LocaleUtils.locale="en_US",document.querySelector("title").innerHTML="West World"):(LocaleUtils.locale="zh_CN",document.querySelector("title").innerHTML="西部世界"),localStorage.setItem("eatchicken_locale",LocaleUtils.locale),B.text=LocaleUtils.getLabelById("zh_CN"==LocaleUtils.locale?"en_US":"zh_CN","locale"),I()},this),this.descriptionContainer.x=350,this.descriptionContainer.y=60,this.descriptionContainer.width=800,this.descriptionContainer.height=1e3,this.descriptionBox.graphics.clear(),this.descriptionBox.graphics.beginFill(16240036,.8),this.descriptionBox.graphics.lineStyle(2,0,.8),this.descriptionBox.graphics.drawRoundRect(0,0,800,1e3,15,15),this.descriptionBox.graphics.endFill(),this.descriptionContainer.addChild(this.descriptionBox),U=new egret.Shape,U.graphics.beginFill(5197647,.8),U.graphics.drawRoundRect(0,0,800,30,15,15),this.descriptionContainer.addChild(U),this.descriptionTitle.x=350,this.descriptionTitle.y=5,this.descriptionTitle.size=20,this.descriptionTitle.textColor=16777215,this.descriptionTitle.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.desc.caption"),this.descriptionContainer.addChild(this.descriptionTitle),S=this.createBitmapByName("close_png"),this.descriptionContainer.addChild(S),S.x=770,S.y=0,S.touchEnabled=!0,S.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){P.gameContainer.removeChild(P.descriptionContainer)},this),this.description.x=10,this.description.y=35,this.description.width=780,this.description.height=980,this.description.size=22,this.description.textColor=0,this.description.$setWordWrap(!0),this.description.$setMultiline(!0),this.description.textFlow=(new egret.HtmlTextParser).parser(LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.desc")),this.description.scrollV=0,this.descriptionContainer.addChild(this.description),this.oneEosContainer.x=180,this.oneEosContainer.y=70,this.gameContainer.addChild(this.oneEosContainer),this.threeEosContainer.x=180,this.threeEosContainer.y=390,this.gameContainer.addChild(this.threeEosContainer),this.fiveEosContainer.x=180,this.fiveEosContainer.y=700,this.gameContainer.addChild(this.fiveEosContainer),navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)&&(this.mobile=!0),this.refreshHouseList(),I=function(){P.description.textFlow=(new egret.HtmlTextParser).parser(LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.desc")),P.descriptionTitle.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.desc.caption"),P.messageTitle.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.notice.bar.title"),b.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.desc.caption"),i.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.all"),c.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.all"),y.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.all"),n.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.joinable"),g.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.joinable"),_.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.joinable"),s.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.ongoing"),d.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.ongoing"),v.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.ongoing"),P.updateGameList(P.eos_one.slice(0,7),"game_png",P.oneEosContainer,P.eos_one,0),P.updateGameList(P.eos_three.slice(0,7),"game_1_png",P.threeEosContainer,P.eos_three,0),P.updateGameList(P.eos_five.slice(0,7),"game_2_png",P.fiveEosContainer,P.eos_five,0),null==ScatterUtils.getCurrentAccountName()?P.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.login"):P.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.logout")},[2]}})})},t.prototype.popMessageBox=function(e){var t=this;egret.clearTimeout(this.messageTimeout),this.messageTimeout=egret.setTimeout(function(){t.message.text="",t.gameContainer.removeChild(t.messageContainer)},this,4e3),this.gameContainer.addChild(this.messageContainer),this.message.text=e},t.prototype.refreshHouseList=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,ScatterUtils.getAllGamesInfo().then(function(t){return __awaiter(e,void 0,void 0,function(){var e,i,a;return __generator(this,function(n){switch(n.label){case 0:return this.eos_one,this.eos_three,this.eos_five=[],t.rows?(e=this,[4,t.rows.filter(function(e){return"1.0000 EOS"==e.join_eos})]):[3,4];case 1:return e.eos_one=n.sent(),i=this,[4,t.rows.filter(function(e){return"3.0000 EOS"==e.join_eos})];case 2:return i.eos_three=n.sent(),a=this,[4,t.rows.filter(function(e){return"5.0000 EOS"==e.join_eos})];case 3:return a.eos_five=n.sent(),this.updateGameList(this.eos_one.slice(0,7),"game_png",this.oneEosContainer,this.eos_one,0),this.updateGameList(this.eos_three.slice(0,7),"game_1_png",this.threeEosContainer,this.eos_three,0),this.updateGameList(this.eos_five.slice(0,7),"game_2_png",this.fiveEosContainer,this.eos_five,0),[3,5];case 4:this.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.not.found")),n.label=5;case 5:return[2]}})})})["catch"](function(t){console.error(t),e.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.fetch.failure"))})];case 1:return t.sent(),[2]}})})},t.prototype.filterAndUpdateGameList=function(e,t,i,a){return __awaiter(this,void 0,void 0,function(){var n,o;return __generator(this,function(s){switch(s.label){case 0:switch(n=[],e){case 1:n=this.eos_one;break;case 3:n=this.eos_three;break;case 5:n=this.eos_five}return n.length>0?(o=void 0,0>t?(o=n,[3,3]):[3,1]):[3,4];case 1:return[4,n.filter(function(e){return e.game_progress==t})];case 2:o=s.sent(),s.label=3;case 3:this.updateGameList(o.slice(0,7),i,a,o,0),s.label=4;case 4:return[2]}})})},t.prototype.updateGameList=function(e,t,i,a,n){var o=this;i.removeChildren(),e.map(function(e,a){o.createHouse({name:"johny",bitmap:t},e).then(function(t){t.setPosition(new egret.Point(180*a,0)),i.addChild(t);var n,o;switch(e.game_progress){case 0:n=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.notstart"),o=60928;break;case 1:n=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.joinable"),o=60928;break;case 2:n=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.ongoing"),o=16776960;break;case 3:n=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.over"),o=16711680;break;default:n=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status.notstart")}var s=new egret.Shape;s.graphics.beginFill(o),s.graphics.lineStyle(2,0,.5),s.graphics.drawRoundRect(180*a,215,150,40,15,15),s.graphics.endFill(),i.addChild(s);var r=new egret.TextField;r.x=180*a,r.y=216,r.size=18,r.textColor=0,r.text=" "+LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.room.num")+(e.game_id+1)+"   "+LocaleUtils.getLabelById(LocaleUtils.locale,"game.player")+" "+e.players.length+"\n"+(" "+LocaleUtils.getLabelById(LocaleUtils.locale,"hall.game.status")+" "+n),i.addChild(r)})});var s=0;a.map(function(e,r){if(a.length>7&&r%7==0){var l=new egret.Shape,c=r==n?16417368:16777215;l.graphics.beginFill(c),l.graphics.lineStyle(1,0,.5),l.graphics.drawRect(50*s,260,30,30),l.graphics.endFill(),i.addChild(l),l.touchEnabled=!0,l.addEventListener(egret.TouchEvent.TOUCH_TAP,o.updateGameList.bind(o,a.slice(r,r+7),t,i,a,r),o);var h=new egret.TextField;h.x=10>s?50*s+10:50*s+5,h.y=268,h.size=18,h.textColor=0,s++,h.text=s.toString(),i.addChild(h)}})},t.prototype.createGame=function(e){var t=this;ScatterUtils.getIdentity().then(function(i){return null==i?void t.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.authority")):void ScatterUtils.createGame(e+" EOS").then(function(e){e.processed?t.refreshHouseList():(e=JSON.parse(e),t.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"hall.notice.failed.create",[e.error.details[0].message])))})["catch"](function(e){console.log(e),t.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"hall.notice.cancel.create"))})})},t.prototype.createHouse=function(e,t){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(a){return i=new House(e,t),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.getID();document.location.href="game.html?id="+e},this),[2,i]})})},t.prototype.loginGame=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return ScatterUtils.login().then(function(t){t.login?(e.gameContainer.contains(e.login)&&e.gameContainer.removeChild(e.login),e.gameContainer.contains(e.logout)||e.gameContainer.addChild(e.logout),e.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.message.login.success",[t.account])),e.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.logout"),e.gameContainer.addChild(e.identityText)):1==t.code?e.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.nowallet")):2==t.code&&e.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.wallet.locked",[LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.walletlock"),LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.noidentity")]))})["catch"](function(t){console.log("e",t),e.popMessageBox(t)}),[2]})})},t.prototype.logoutGame=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return ScatterUtils.logout().then(function(t){t.logout&&(e.gameContainer.contains(e.logout)&&e.gameContainer.removeChild(e.logout),e.gameContainer.contains(e.login)||e.gameContainer.addChild(e.login),e.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.message.logout.success",[t.account])),e.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.login"),e.gameContainer.addChild(e.identityText))})["catch"](function(t){console.log("e",t),e.popMessageBox(t)}),[2]})})},t.prototype.animation=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(a){return t=new egret.MovieClipDataFactory(RES.getRes(e.json),RES.getRes(e.png)),i=new egret.MovieClip(t.generateMovieClipData(e.data)),i.x=e.x,i.y=e.y,[2,i]})})},t.prototype.recall=function(e){if(e||(e=this.selectedPlayer),e){this.unmountMovement(),this.clearRoute(e.getTask().action);var t=e.getTask().status,i=e.getHouse(),a=i.getPosition(),n=e.getBitmap();egret.Tween.removeTweens(n),t&&"completed"==t?egret.Tween.get(n).to(a,1e3,egret.Ease.sineIn):egret.Tween.get(n).to(a,0,egret.Ease.sineIn),e.setTask({action:"idle",target:null,status:null})}},t.prototype.initTask=function(e){var t=this;this.selectedPlayer?(this.unmountMovement(),this.selectedPlayer.setTask({action:e,target:null,status:null}),setTimeout(function(){t.mountMovement()},300)):console.log("no warrior selected")},t.prototype.showLife=function(e,t){var i,a=t.getLife();i=a.remain>=.6*a.full?60928:a.remain>=.4*a.full&&a.remain<.6*a.full?16776960:16711680,this._life.graphics.clear(),this._life.graphics.lineStyle(4,i),this._life.graphics.moveTo(t.getPosition().x,t.getPosition().y),this._life.graphics.lineTo(t.getPosition().x+a.remain,t.getPosition().y),e.addChild(this._life)},t.prototype.showText=function(e,t){this.textfield.x=t.x,this.textfield.y=t.y,this.textfield.size=22,this.textfield.textColor=0,this.textfield.text=e},t.prototype.actionSound=function(e){var t=new egret.Sound;t.addEventListener(egret.Event.COMPLETE,function(e){t.play(0,1)},this),t.load(e)},t.prototype.backgroundSound=function(e){this.backgroundMusicChannel&&this.backgroundMusicChannel.stop(),this.backgroundMusic.addEventListener(egret.Event.COMPLETE,this.play,this),this.backgroundMusic.load(e)},t.prototype.play=function(){this.backgroundMusicChannel=this.backgroundMusic.play(0,0)},t.prototype.movePlayer=function(e){if(null!=this.selectedPlayer&&"undefined"!=typeof this.selectedPlayer){this.stage.contains(this._life)&&this.stage.removeChild(this._life);var t=this.selectedPlayer.getBitmap();egret.Tween.removeTweens(t);var i={x:t.x,y:t.y},a={x:e.stageX,y:e.stageY},n=this.selectedPlayer.getTask().action;this.drawRoute(i,a,n);var o={x:e.stageX-17,y:e.stageY-25};egret.Tween.get(t).to(o,3e3,egret.Ease.sineIn).wait(500).call(this.doAction.bind(this,this.selectedPlayer,n,o,a))}},t.prototype.mountMovement=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.movePlayer,this)},t.prototype.unmountMovement=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.movePlayer,this)},t.prototype.doAction=function(e,t,i,a){var n=this;this.clearRoute(t);var o=e.getTask().target,s=null==o||null==o.getBitmap()?!1:o.getBitmap().hitTestPoint(a.x,a.y,!0);if(s){var r=this.createBitmapByName("sword_png");r.x=i.x,r.y=i.y,this.stage.addChild(r),"attack"==t?this.attackTarget(i).then(function(){e.setTask({action:"attack",target:null,status:"completed"}),n.recall(e)}):e.setTask({action:"enforce",target:o,status:"completed"}),setTimeout(function(){n.stage.removeChild(r),r=null},1e3)}else e.setTask({action:"idle",target:null})},t.prototype.attackTarget=function(e){var t=this,i=new egret.MovieClipDataFactory(RES.getRes("fight_json"),RES.getRes("fight_png")),a=new egret.MovieClip(i.generateMovieClipData("fight"));a.x=e.x,a.y=e.y,a.width=50,a.height=50,this.board.addChild(a),a.play(20),this.actionSound(RES.getRes("shooting_mp3").url);var n=new egret.MovieClipDataFactory(RES.getRes("money_json"),RES.getRes("money_png")),o=new egret.MovieClip(n.generateMovieClipData("money"));return o.x=e.x,o.y=e.y-30,this.board.addChild(o),o.play(2),this.actionSound(RES.getRes("destroyhuman_wav").url),setTimeout(function(){t.board.removeChild(o)},2e3),new Promise(function(e,i){setTimeout(function(){t.board.removeChild(a),t.board.contains(t._life)&&t.board.removeChild(t._life),e()},1e3)})},t.prototype.drawRoute=function(e,t,i){this.clearRoute(i);var a,n,o;switch(i){case"attack":a=16711680,n=25,o=25;break;case"enforce":a=60928,n=10,o=50;break;default:a=16776960,n=10,o=50}this._route.graphics.lineStyle(2,a),this._route.graphics.moveTo(e.x,e.y),this._route.graphics.lineTo(t.x,t.y),this[i].x=t.x-n,this[i].y=t.y-o,this.stage.addChild(this[i])},t.prototype.clearRoute=function(e){this._route.graphics.clear(),this.stage.contains(this[e])&&this.stage.removeChild(this[e]),this.stage.contains(this._life)&&this.stage.removeChild(this._life)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.mouseDown=function(e){null==this.touchPoints[e.touchPointID]&&(this.touchPoints[e.touchPointID]=new egret.Point(e.stageX,e.stageY),this.touchPoints.names.push(e.touchPointID)),this.touchCon++,2==this.touchCon&&(this.distance=this.getTouchDistance())},t.prototype.mouseMove=function(e){if(2==this.touchCon){this.touchPoints[e.touchPointID].x=e.stageX,this.touchPoints[e.touchPointID].y=e.stageY;var t=this.getTouchDistance();this.gameContainer.scaleX=t/this.distance,this.gameContainer.scaleY=this.gameContainer.scaleX}else if(this.mobile){var i=e.stageX-this.touchPoints[e.touchPointID].x,a=e.stageY-this.touchPoints[e.touchPointID].y;this.gameContainer.x=i+this.lastPositionX,this.gameContainer.y=a+this.lastPositionY}},t.prototype.mouseUp=function(e){delete this.touchPoints[e.touchPointID],this.touchCon--,this.lastPositionX=this.gameContainer.x,this.lastPositionY=this.gameContainer.y,this.width*=this.scaleX,this.height*=this.scaleY,this.scaleX=1,this.scaleY=1,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},t.prototype.getTouchDistance=function(){var e=0,t=this.touchPoints.names;return e=egret.Point.distance(this.touchPoints[t[t.length-1]],this.touchPoints[t[t.length-2]])},t.prototype.removePlayerIcon=function(e){var t=this,i=e.getUUID();this.soilderIconList.map(function(e,a){e.key==i&&(t.stage.contains(e.icon)&&t.stage.removeChild(e.icon),t.soilderIconList.splice(a,1))})},t.prototype.refrashPlayerIcon=function(){this.soilderIconList.map(function(e,t){e.icon.x=110+68*t})},t.prototype.startAnimation=function(e){var t=this,i=new egret.HtmlTextParser,a=e.map(function(e){return i.parse(e)}),n=this.textfield,o=-1,s=function(){o++,o>=a.length&&(o=0);var e=a[o];n.textFlow=e;var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(s,t)};s()},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Board=function(e){function t(t,i){var a=e.call(this)||this;return a.playerContainer=new egret.DisplayObjectContainer,a.colorMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],a.createBoard(t,i),a}return __extends(t,e),t.prototype.createBoard=function(e,t){this.cellList=[];for(var i=0;t>i;i++)for(var a=0;e>a;a++){var n=this.createCell(a,i,this.cellList.length);this.addChild(n)}this.addChild(this.playerContainer)},t.prototype.createCell=function(e,t,i){var a=new Cell(e,t,i);return this.cellList.push(a),a},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.getCellList=function(){return this.cellList},t.prototype.getCellById=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.cellList.filter(function(t){return t.getID()==e})];case 1:return t=i.sent(),[2,t[0]]}})})},t.prototype.getCellByXY=function(e,t){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(a){switch(a.label){case 0:return[4,this.cellList.filter(function(i){var a=i.getXY();return a.x==e&&a.y==t})];case 1:return i=a.sent(),[2,i[0]]}})})},t.prototype.putPlayer=function(e){this.playerContainer.addChild(e)},t.prototype.clearPlayers=function(){this.playerContainer.removeChildren()},t.prototype.removePlayer=function(e){this.playerContainer.removeChild(e)},t.prototype.setIndex=function(e,t){this.playerContainer.setChildIndex(e,t)},t}(egret.DisplayObjectContainer);__reflect(Board.prototype,"Board");var Game=function(e){function t(){var t=e.call(this)||this;return t.gameContainer=new egret.DisplayObjectContainer,t._touchStatus=!1,t._distance=new egret.Point,t.textfield=new egret.TextField,t.tmxTileMap=tiled.TMXTilemap,t._route=new egret.Shape,t._life=new egret.Shape,t.kickOffText=new egret.TextField,t.soilderIconList=[],t.board=null,t.login=new egret.Shape,t.logout=new egret.Shape,t.identityText=new egret.TextField,t.backgroundMusic=new egret.Sound,t.playerInfo=new egret.Shape,t.player_name=new egret.TextField,t.player_hp=new egret.TextField,t.player_attack=new egret.TextField,t.player_defense=new egret.TextField,t.player_eos=new egret.TextField,t.player_item=new egret.TextField,t.player_weapon=new egret.TextField,t.safeAreaTop=new egret.Shape,t.safeAreaLeft=new egret.Shape,t.safeAreaRight=new egret.Shape,t.safeAreaBottom=new egret.Shape,t.playerProfileListContainer=new egret.DisplayObjectContainer,t.honorListContainer=new egret.DisplayObjectContainer,t.honorListBox=new egret.Shape,t.honorListText=new egret.TextField,t.summaryContainer=new egret.DisplayObjectContainer,t.summaryBox=new egret.Shape,t.summaryTitle=new egret.TextField,t.summaryContent=new egret.TextField,t.cellDetailsContainer=new egret.DisplayObjectContainer,t.cellDetailsBox=new egret.Shape,t.cellDetailsTitle=new egret.TextField,t.cellDetailsContent=new egret.TextField,t.messageContainer=new egret.DisplayObjectContainer,t.messageBox=new egret.Shape,t.messageTitle=new egret.TextField,t.message=new egret.TextField,t.moveZoneContainer=new egret.DisplayObjectContainer,t.moveZoneBox=new egret.Shape,t.mobile=!1,t.townRandomName=["johny","kitty","peter"],t.num=0,t.interval=null,t.messageTimeout=null,t.poisons=[],t.colorFlilter=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),t.touchPoints={names:[]},t.distance=0,t.touchCon=0,t.lastPositionX=0,t.lastPositionY=0,t.canvas=document.getElementsByTagName("CANVAS")[0],t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t
}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return LocaleUtils.locale=null==localStorage.getItem("eatchicken_locale")?"zh_CN":localStorage.getItem("eatchicken_locale").toString(),[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[4,RES.loadConfig("resource/lazy.res.json","resource/")];case 2:return e.sent(),[4,RES.loadGroup("lazy",0)];case 3:return e.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return i.sent(),this.stage.removeChild(e),[3,4];case 3:return t=i.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,a,n,o,s,r,l,c,h,g,u,d=this;return __generator(this,function(p){return this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this),this.stage.addChild(this.gameContainer),e=this.createBitmapByName("town_png"),this.gameContainer.addChild(e),e.width=80,e.height=80,e.x=10,e.y=5,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){document.location.href="index.html"},this),this.setMapFlat=this.createBitmapByName("setmap_png"),this.setMapFlat.width=80,this.setMapFlat.height=80,this.setMapFlat.x=10,this.setMapFlat.y=115,this.setMapFlat.touchEnabled=!0,this.setMapFlat.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setMap,this),this.kickOffFlat=this.createBitmapByName("kickoff_png"),this.kickOffFlat.x=10,this.kickOffFlat.y=220,this.kickOffFlat.touchEnabled=!0,this.kickOffFlat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.kickOff.call(d),d.currentHouse.getPlayerList().map(function(e){e.setMoveable(!0)})},this),this.kickOffText.x=20,this.kickOffText.y=253,this.kickOffText.size=16,this.kickOffText.textColor=0,this.kickOffText.$setBold(!0),this.kickOffText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.start"),this.summaryContainer.x=1200,this.summaryContainer.y=100,this.summaryContainer.width=250,this.summaryContainer.height=100,this.gameContainer.addChild(this.summaryContainer),this.summaryBox.graphics.clear(),this.summaryBox.graphics.beginFill(16240036,.2),this.summaryBox.graphics.lineStyle(2,0,.5),this.summaryBox.graphics.drawRoundRect(0,0,250,100,15,15),this.summaryBox.graphics.endFill(),this.summaryContainer.addChild(this.summaryBox),t=new egret.Shape,t.graphics.beginFill(5197647,.8),t.graphics.drawRoundRect(0,0,250,30,15,15),this.summaryContainer.addChild(t),this.summaryTitle.x=90,this.summaryTitle.y=5,this.summaryTitle.size=20,this.summaryTitle.textColor=16777215,this.summaryTitle.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.statistic.bar.title"),this.summaryContainer.addChild(this.summaryTitle),this.summaryContent.x=10,this.summaryContent.y=35,this.summaryContent.width=250,this.summaryContent.height=100,this.summaryContent.size=20,this.summaryContent.textColor=0,this.summaryContent.$setWordWrap(!0),this.summaryContent.$setMultiline(!0),this.summaryContent.restrict="",this.summaryContainer.addChild(this.summaryContent),this.messageContainer.x=1200,this.messageContainer.y=210,this.messageContainer.width=250,this.messageContainer.height=250,this.gameContainer.addChild(this.messageContainer),this.messageBox.graphics.clear(),this.messageBox.graphics.beginFill(16240036,.4),this.messageBox.graphics.lineStyle(2,0,.5),this.messageBox.graphics.drawRoundRect(0,0,250,250,15,15),this.messageBox.graphics.endFill(),this.messageContainer.addChild(this.messageBox),i=new egret.Shape,i.graphics.beginFill(5197647,.8),i.graphics.drawRoundRect(0,0,250,30,15,15),this.messageContainer.addChild(i),this.messageTitle.x=90,this.messageTitle.y=5,this.messageTitle.size=20,this.messageTitle.textColor=16777215,this.messageTitle.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.message.bar.title"),this.messageContainer.addChild(this.messageTitle),this.message.x=10,this.message.y=35,this.message.width=230,this.message.height=200,this.message.size=20,this.message.textColor=0,this.message.$setWordWrap(!0),this.message.$setMultiline(!0),this.messageContainer.addChild(this.message),this.cellDetailsContainer.x=1200,this.cellDetailsContainer.y=470,this.cellDetailsContainer.width=250,this.cellDetailsContainer.height=500,this.cellDetailsBox.graphics.clear(),this.cellDetailsBox.graphics.beginFill(16240036,.4),this.cellDetailsBox.graphics.lineStyle(2,0,.5),this.cellDetailsBox.graphics.drawRoundRect(0,0,250,500,15,15),this.cellDetailsBox.graphics.endFill(),this.cellDetailsContainer.addChild(this.cellDetailsBox),a=new egret.Shape,a.graphics.beginFill(5197647,.8),a.graphics.drawRoundRect(0,0,250,30,15,15),this.cellDetailsContainer.addChild(a),this.cellDetailsTitle.x=100,this.cellDetailsTitle.y=5,this.cellDetailsTitle.size=20,this.cellDetailsTitle.textColor=16777215,this.cellDetailsTitle.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.grid.bar.title"),this.cellDetailsContainer.addChild(this.cellDetailsTitle),this.cellDetailsContent.x=10,this.cellDetailsContent.y=35,this.cellDetailsContent.width=230,this.cellDetailsContent.height=450,this.cellDetailsContent.size=20,this.cellDetailsContent.textColor=0,this.cellDetailsContent.$setWordWrap(!0),this.cellDetailsContent.$setMultiline(!0),this.cellDetailsContainer.addChild(this.cellDetailsContent),this.moveZoneContainer.width=240,this.moveZoneContainer.height=240,this.moveZoneBox.graphics.clear(),this.moveZoneBox.graphics.beginFill(255,.1),this.moveZoneBox.graphics.drawRoundRect(0,0,240,240,15,15),this.moveZoneBox.graphics.endFill(),this.moveZoneContainer.addChild(this.moveZoneBox),this.honorListContainer.width=880,this.honorListContainer.height=880,this.honorListBox.graphics.clear(),this.honorListBox.graphics.beginFill(4473924,.8),this.honorListBox.graphics.drawRoundRect(0,0,880,880,15,15),this.honorListBox.graphics.endFill(),this.honorListContainer.addChild(this.honorListBox),n=new egret.Shape,n.graphics.beginFill(16711680,.8),n.graphics.drawRoundRect(0,0,880,121,15,15),this.honorListContainer.addChild(n),o=new egret.TextField,o.x=380,o.y=40,o.size=40,o.textColor=16777215,o.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.honor.bulletin"),this.honorListContainer.addChild(o),this.honorListText.width=880,this.honorListText.height=880,this.honorListText.size=22,this.honorListText.textColor=16777215,this.honorListText.$setWordWrap(!0),this.honorListText.$setMultiline(!0),this.honorListContainer.addChild(this.honorListText),this.login.graphics.beginFill(60928),this.login.graphics.lineStyle(2,0),this.login.graphics.drawRoundRect(1200,5,100,50,15,15),this.login.graphics.endFill(),this.login.touchEnabled=!0,this.login.addEventListener(egret.TouchEvent.TOUCH_TAP,this.loginGame,this),this.logout.graphics.beginFill(16776960),this.logout.graphics.lineStyle(2,0),this.logout.graphics.drawRoundRect(1200,5,100,50,15,15),this.logout.graphics.endFill(),this.logout.touchEnabled=!0,this.logout.addEventListener(egret.TouchEvent.TOUCH_TAP,this.logoutGame,this),ScatterUtils.getIdentity().then(function(e){null==e?(d.gameContainer.addChild(d.login),d.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.login")):(ScatterUtils.login(),d.gameContainer.addChild(d.logout),d.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.logout")),d.identityText.x=1210,d.identityText.y=18,d.identityText.size=25,d.identityText.textColor=0,d.gameContainer.addChild(d.identityText)}),this.show=this.createBitmapByName("show_png"),this.show.x=1350,this.show.y=10,this.show.width=40,this.show.height=40,this.show.touchEnabled=!0,this.show.$setVisible(!1),this.gameContainer.addChild(this.show),this.show.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.show.$setVisible(!1),d.hide.$setVisible(!0),d.changeDetailMode(!1)},this),this.hide=this.createBitmapByName("hide_png"),this.hide.x=1350,this.hide.y=10,this.hide.width=40,this.hide.height=40,this.hide.touchEnabled=!0,this.gameContainer.addChild(this.hide),this.hide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.show.$setVisible(!0),d.hide.$setVisible(!1),d.changeDetailMode(!0)},this),s=this.createBitmapByName("music_png"),this.gameContainer.addChild(s),s.x=1400,s.y=5,s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.backgroundMusicChannel&&d.backgroundMusicChannel.stop(),s.$setVisible(!1),r.$setVisible(!0)},this),this.gameContainer.addChild(s),this.backgroundSound(RES.getRes("easy_1_mp3").url),r=this.createBitmapByName("mute_png"),this.gameContainer.addChild(r),r.$setVisible(!1),r.x=1400,r.y=5,r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.backgroundSound(RES.getRes("easy_1_mp3").url),s.$setVisible(!0),r.$setVisible(!1)},this),l=new egret.DisplayObjectContainer,l.x=1450,l.y=5,l.touchEnabled=!0,this.gameContainer.addChild(l),c=new egret.Shape,c.graphics.clear(),c.graphics.beginFill(16240036),c.graphics.lineStyle(2,0,.5),c.graphics.drawRect(0,0,60,40),c.graphics.endFill(),l.addChild(c),h=new egret.TextField,h.x=10,h.y=10,h.size=20,h.textColor=4471354,h.text=LocaleUtils.getLabelById("zh_CN"==LocaleUtils.locale?"en_US":"zh_CN","locale"),l.addChild(h),l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"zh_CN"==LocaleUtils.locale?(LocaleUtils.locale="en_US",document.querySelector("title").innerHTML="West World"):(LocaleUtils.locale="zh_CN",document.querySelector("title").innerHTML="西部世界"),localStorage.setItem("eatchicken_locale",LocaleUtils.locale),h.text=LocaleUtils.getLabelById("zh_CN"==LocaleUtils.locale?"en_US":"zh_CN","locale"),u()},this),navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)&&(this.mobile=!0),g=window.location.href.substr(window.location.href.indexOf("=")+1),this.initBoard().then(function(){d.refreshHouse(g).then(function(){d.updateClockInStage(d.currentHouse.getClock())}),d.interval=egret.setInterval(function(){return __awaiter(d,void 0,void 0,function(){var e,t=this;return __generator(this,function(i){switch(i.label){case 0:return[4,this.refreshHouse(g)];case 1:return i.sent(),this.updateSummaryBoard(),e=this.currentHouse.getProgress(),3==e&&(egret.setTimeout(function(){t.popHonorList()},this,5e3),this.interval&&egret.clearInterval(this.interval)),[2]}})})},d,5e3)}),u=function(){d.summaryTitle.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.statistic.bar.title"),d.messageTitle.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.message.bar.title"),d.cellDetailsTitle.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.grid.bar.title"),o.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.honor.bulletin"),d.kickOffText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.start"),d.updateSummaryBoard(),null==ScatterUtils.getCurrentAccountName()?d.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.login"):d.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.logout")},[2]})})},t.prototype.updateButton=function(){var e=this.currentHouse.getOwner()==ScatterUtils.getCurrentAccountName();if(e){this.gameContainer.contains(this.setMapFlat)||(this.gameContainer.addChild(this.setMapFlat),this.gameContainer.addChild(this.kickOffFlat),this.gameContainer.addChild(this.kickOffText)),this.setMapFlat.$setVisible(!0),this.kickOffFlat.$setVisible(!0),this.kickOffText.$setVisible(!0);var t=this.currentHouse.getProgress();0===t?(this.kickOffFlat.touchEnabled=!1,this.kickOffFlat.filters=[this.colorFlilter]):1===t?(this.setMapFlat.touchEnabled=!1,this.setMapFlat.filters=[this.colorFlilter],this.kickOffFlat.touchEnabled=!0,this.kickOffFlat.filters=[]):(this.setMapFlat.touchEnabled=!1,this.setMapFlat.filters=[this.colorFlilter],this.kickOffFlat.touchEnabled=!1,this.kickOffFlat.filters=[this.colorFlilter])}else this.setMapFlat.$setVisible(!1),this.kickOffFlat.$setVisible(!1),this.kickOffText.$setVisible(!1)},t.prototype.initBoard=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(i){return null==this.board&&(this.board=new Board(11,11),this.board.x=300,this.board.y=100,this.board.width=880,this.board.height=880,this.gameContainer.addChild(this.board),e=this.board.getCellList(),e.map(function(e){e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(null!=t.currentHouse)if(e.onDetailMode())t.showCellDetails(e.getID());else{var i=t.currentHouse.getProgress();0==i||(1==i?t.currentHouse.getPlayerByName(ScatterUtils.getCurrentAccountName()).then(function(i){null===i&&t.joinGame(e)}):2==i&&t.currentHouse.getPlayerByName(ScatterUtils.getCurrentAccountName()).then(function(i){null!==i&&i.isMoveable()&&t.move(e)}))}},t)})),[2]})})},t.prototype.changeDetailMode=function(e){1==e?this.gameContainer.addChild(this.cellDetailsContainer):this.gameContainer.contains(this.cellDetailsContainer)&&this.gameContainer.removeChild(this.cellDetailsContainer);var t=this.board.getCellList();t.map(function(t){t.showDetailMode(e)})},t.prototype.showCellDetails=function(e){return __awaiter(this,void 0,void 0,function(){var t,i=this;return __generator(this,function(a){switch(a.label){case 0:return this.cellDetailsContent.text="",[4,this.currentHouse.getFullPlayersJsonByCellId(e)];case 1:return t=a.sent(),t.map(function(e){i.currentHouse.getPlayerByName(e.acc_name).then(function(e){if(e.isAlive()){var t=function(){var t="";return e.getItems().map(function(e){t=t+ItemUtils.getItemNameById(e,LocaleUtils.locale)+"\n         "}),t};i.cellDetailsContent.text=i.cellDetailsContent.text+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.player")+" "+e.getName()+"\n")+("HP: "+e.getLife()+"\n")+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.weapon")+" "+ItemUtils.getItemNameById(e.getWeapon(),LocaleUtils.locale)+"\n")+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.force")+" "+e.getAttack()+"\n")+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.defence")+" "+e.getDefense()+"\n")+("EOS: "+e.getGold()/1e4+"\n")+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.item")+" "+t()+"\n\n")}})}),[2]}})})},t.prototype.selectPlayer=function(e){this.board.setIndex(e,1);var t=e.getGentle();0==t?this.actionSound(RES.getRes("yes_mp3").url):this.actionSound(RES.getRes("yes_female_mp3").url);var i=function(){var t="";return e.getItems().map(function(e){t=t+ItemUtils.getItemNameById(e,LocaleUtils.locale)+"\n         "}),t},a=LocaleUtils.getLabelById(LocaleUtils.locale,"game.player")+" "+e.getName()+"\n"+("HP: "+e.getLife()+"\n")+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.weapon")+" "+ItemUtils.getItemNameById(e.getWeapon(),LocaleUtils.locale)+"\n")+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.force")+" "+e.getAttack()+"\n")+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.defence")+" "+e.getDefense()+"\n")+("EOS: "+e.getGold()/1e4+"\n")+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.item")+" "+i()+"\n\n");this.popMessageBox(a)},t.prototype.popMessageBox=function(e){var t=this;egret.clearTimeout(this.messageTimeout),this.messageTimeout=egret.setTimeout(function(){t.message.text=""},this,4e3),this.message.text=e},t.prototype.popHonorList=function(){this.board.addChild(this.honorListContainer),this.honorListText.y=150,this.honorListText.text=" "+LocaleUtils.getLabelById(LocaleUtils.locale,"game.honor.winner")+" "+this.currentHouse.getWinner()+"\n\n"+(" "+LocaleUtils.getLabelById(LocaleUtils.locale,"game.honor.killer")+"  "+this.currentHouse.getBestKiller()+"\n\n")+(" "+LocaleUtils.getLabelById(LocaleUtils.locale,"game.honor.eos.winner")+" "+this.currentHouse.getBestEOSWin())},t.prototype.updateSummaryBoard=function(){this.currentHouse.getPlayerJsonList();this.summaryContent.text=LocaleUtils.getLabelById(LocaleUtils.locale,"game.statistic.total.players")+" "+this.currentHouse.getTotalJoinPlayers()+"\n"+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.statistic.total.eos")+" "+(this.currentHouse.getEOSInHouse()+".0000")+"\n")+(LocaleUtils.getLabelById(LocaleUtils.locale,"game.statistic.survive.players")+" "+this.currentHouse.getAlivePlayers())},t.prototype.createSafeAreaInBoard=function(e){var t=this;this.board.contains(this.safeAreaTop)||(this.board.addChild(this.safeAreaTop),this.board.addChild(this.safeAreaLeft),this.board.addChild(this.safeAreaRight),this.board.addChild(this.safeAreaBottom)),this.safeAreaTop.graphics.clear(),this.safeAreaTop.graphics.beginFill(65280,.2),this.safeAreaTop.graphics.drawRect(0,0,this.board.width,80*(5-e)),this.safeAreaTop.graphics.endFill(),this.safeAreaLeft.graphics.clear(),this.safeAreaLeft.graphics.beginFill(65280,.2),this.safeAreaLeft.graphics.drawRect(0,80*(5-e),80*(5-e),this.board.height-80*(5-e)*2),this.safeAreaLeft.graphics.endFill(),this.safeAreaRight.graphics.clear(),this.safeAreaRight.graphics.beginFill(65280,.2),this.safeAreaRight.graphics.drawRect(this.board.width-80*(5-e),80*(5-e),80*(5-e),this.board.height-80*(5-e)*2),this.safeAreaRight.graphics.endFill(),this.safeAreaBottom.graphics.clear(),this.safeAreaBottom.graphics.beginFill(65280,.2),this.safeAreaBottom.graphics.drawRect(0,this.board.height-80*(5-e),this.board.width,80*(5-e)),this.safeAreaBottom.graphics.endFill();var i=5-e;if(this.poisons.length<4*i)for(var a=this.poisons.length/4;i>a;a++)for(var n=function(e){var i,n;0==e?(i={x:0,y:80*a},n={x:800,y:80*a}):1==e?(i={x:80*a,y:0},n={x:80*a,y:800}):2==e?(i={x:800-80*a,y:800},n={x:800-80*a,y:0}):3==e&&(i={x:800,y:800-80*a},n={x:0,y:800-80*a}),o.animation({json:"poison_json",png:"poison_png",data:"poison",x:i.x,y:i.y}).then(function(e){e.$setScaleX(.6),e.$setScaleY(.6),e.$alpha=.5,e.play(-1),t.board.addChild(e),t.poisons.push(e),r(e,i,n)})},o=this,s=0;4>s;s++)n(s);var r=function(e,i,a){egret.Tween.get(e).to(a,6e3+4e3*Math.random(),egret.Ease.sineIn).wait(0).call(r.bind(t,e,a,i))}},t.prototype.updateObjectsInBoard=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,a,n,o=this;return __generator(this,function(s){switch(s.label){case 0:return this.board.clearPlayers(),t=e.getBoard(),i=this.board.getCellList(),a=e.getProgress(),n=e.getStep(),[4,i.map(function(i,s){return __awaiter(o,void 0,void 0,function(){var o,r,l,c,h,g,u,d,p,m,y,f=this;return __generator(this,function(_){switch(_.label){case 0:return o=t[s],[4,i.getItem()];case 1:return r=_.sent(),l=o.item,[4,ItemUtils.createItemById(l)];case 2:return c=_.sent(),[4,e.getFullPlayersJsonByCellId(i.getID())];case 3:return h=_.sent(),h.length>0?(g=function(){return __awaiter(f,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,o.event_list.filter(function(e){return"move"==e.evt||"join"==e.evt})];case 1:return e=i.sent(),e.length>0?(t=e[e.length-1].who,[2,t]):[2,null]}})})},[4,g()]):[3,6];case 4:return u=_.sent(),[4,h.map(function(t){e.getPlayerByName(t.acc_name).then(function(e){if(e.isAlive()){0==e.x&&0==e.y&&e.setPosition(new egret.Point(i.x+10*Math.random(),i.y+10*Math.random())),f.board.putPlayer(e),e.getName()==u?f.board.setIndex(e,1):f.board.setIndex(e,0);var t=e.getName();if(t!==ScatterUtils.getCurrentAccountName()){var a=e.x-i.x,n=e.y-i.y;if(a>0&&80>a&&n>0&&80>n)egret.Tween.get(e).to({x:i.x+10*Math.random(),y:i.y+10*Math.random()},500,egret.Ease.sineIn);else{var o=void 0;o=e.x>i.x?"horse-left_png":"horse_png",e.$setVisible(!1),f.animation({json:"horse_json",png:o,data:"horse",x:e.x,y:e.y}).then(function(t){f.board.addChild(t),t.$setScaleX(.8),t.$setScaleY(.8),t.play(-1);var a={x:i.x+10*Math.random(),y:i.y+10*Math.random()};egret.Tween.get(t).to(a,500,egret.Ease.sineIn).wait(0).call(function(){f.board.removeChild(t),e.$setVisible(!0),e.setPosition(a)})})}}}})})];case 5:_.sent(),2==a&&null!=r&&null!=c&&this.checkCellItemEffect(i,r,c),3==a?(d=t[60].event_list,p=d[d.length-1],this.checkBattersInCell(p.progress,p.step,o.event_list,i)):this.checkBattersInCell(a,n,o.event_list,i),_.label=6;case 6:return m=o.item_drop_ticks,y=o.item_drop_triggered,1===y&&(0!==m?(i.hasFallDownSign()||this.animation({json:"arrow-down_json",png:"arrow-down_png",data:"arrow-down",x:30,y:30}).then(function(e){e.play(-1),i.addChild(e),i.addFallDownSign(!0)}),this.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.item.fall",[ItemUtils.getItemNameById(c.getId(),LocaleUtils.locale)]))):i.removeChildren()),0!=m?[3,8]:(c.x=15,c.y=15,[4,i.addItem(c)]);case 7:_.sent(),1!=y||null===r||0!==r.getId()||5!=l&&8!=l&&13!=l||(c.y=-300,egret.Tween.get(c).to({x:0,y:0},1500,egret.Ease.sineIn).wait(0).call(function(){f.actionSound(RES.getRes("item_fall_mp3").url)})),_.label=8;case 8:return[2]}})})})];case 1:return s.sent(),[2]}})})},t.prototype.updatePlayerProfileInStage=function(e){var t=this;this.gameContainer.contains(this.playerProfileListContainer)||(this.gameContainer.addChild(this.playerProfileListContainer),this.playerProfileListContainer.x=300,this.playerProfileListContainer.y=10),this.playerProfileListContainer.removeChildren(),e.map(function(e,i){var a;a=e.getName()==ScatterUtils.getCurrentAccountName()?t.createBitmapByName("portraitFrame_self_png"):t.createBitmapByName("portraitFrame_png"),a.$setX(80*i+5),a.$setY(6),a.$setWidth(72),a.$setHeight(68);var n=e.getPlayerProfile().texture,o=new egret.Bitmap(n);o.$setX(80*i),o.$setY(0),o.$setWidth(80),o.$setHeight(72),t.playerProfileListContainer.addChild(a),t.playerProfileListContainer.addChild(o),e.isAlive()?(o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,t.selectPlayer.bind(t,e),t)):o.filters=[t.colorFlilter]})},t.prototype.refreshHouse=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(i){switch(i.label){case 0:return[4,ScatterUtils.getGameInfo(parseInt(e)).then(function(e){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return e.rows.length>0?(t=e.rows[0],null!=this.currentHouse?[3,1]:(this.currentHouse=new House({name:"johny",bitmap:"house_png"},t),[3,3])):[3,5];case 1:return[4,this.currentHouse.updateHouse(t)];case 2:i.sent(),i.label=3;case 3:return[4,this.updateObjectsInBoard(this.currentHouse)];case 4:return i.sent(),this.createSafeAreaInBoard(this.currentHouse.getSafeAreaRadius()),this.updatePlayerProfileInStage(this.currentHouse.getPlayerList()),this.updateButton(),this.checkMoveZone(),this.resetClock(),[3,6];case 5:this.currentHouse=null,this.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.not.found")),i.label=6;case 6:return[2]}})})})["catch"](function(e){console.error(e),t.currentHouse=null,t.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.fetch.failure"))})];case 1:return i.sent(),[2]}})})},t.prototype.joinGame=function(e){var t=this;ScatterUtils.getIdentity().then(function(i){if(null==i)return void t.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.authority"));var a=e.getXY(),n=e.getPosition();ScatterUtils.joinGame(t.currentHouse.getID(),t.currentHouse.getJoinEos(),a.y,a.x).then(function(e){if(e.processed){t.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.message.join.success"));var i=new Player("jump_png",{});t.board.putPlayer(i),i.setPosition(new egret.Point(n.x,n.y-300)),egret.Tween.get(i).to(n,300,egret.Ease.sineIn).wait(0).call(function(){t.actionSound(RES.getRes("player_fall_mp3").url)})}else e=JSON.parse(e),t.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.message.join.failed",[e.error.details[0].message]))})["catch"](function(e){console.error(e),t.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.message.join.failed",[e]))})})},t.prototype.setMap=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return ScatterUtils.getIdentity().then(function(t){return null==t?void e.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.authority")):void ScatterUtils.setMap(e.currentHouse.getID()).then(function(t){1==t.succ?e.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.message.setmap.success")):e.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.message.setmap.success"))})}),[2]})})},t.prototype.move=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(i){return ScatterUtils.getIdentity().then(function(i){if(null==i)return void t.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.authority"));var a=e.getXY(),n=e.getPosition();t.animation({json:"arrow-down_json",png:"arrow-down_png",data:"arrow-down",x:n.x+30,y:n.y+25}).then(function(e){t.board.addChild(e),e.$setScaleX(1.5),e.$setScaleY(1.5),e.play(-1),ScatterUtils.move(t.currentHouse.getID(),a.y,a.x).then(function(i){return __awaiter(t,void 0,void 0,function(){var t=this;return __generator(this,function(a){return i.processed?this.currentHouse.getPlayerByName(ScatterUtils.getCurrentAccountName()).then(function(i){if(null!=i){var a=void 0;a=i.x>n.x?"horse-left_png":"horse_png",i.$setVisible(!1),t.animation({json:"horse_json",png:a,data:"horse",x:i.x,y:i.y}).then(function(a){t.board.addChild(a),a.$setScaleX(.8),a.$setScaleY(.8),a.play(-1),egret.Tween.get(a).to(n,500,egret.Ease.sineIn).wait(0).call(function(){t.board.removeChild(a),t.board.removeChild(e),i.setPosition(n),i.$setVisible(!0)})}),i.setMoveable(!1),t.checkMoveZone()}}):(i=JSON.parse(i),this.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.message.move.failed")),this.board.removeChild(e)),[2]})})})["catch"](function(i){console.error(i),t.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.message.move.failed")),t.board.removeChild(e)})})}),[2]})})},t.prototype.checkMoveZone=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return this.currentHouse.getPlayerByName(ScatterUtils.getCurrentAccountName()).then(function(t){if(null!=t){var i=t.isMoveable();i?e.board.getCellById(t.getCellId()).then(function(i){e.moveZoneContainer.x=i.getPosition().x-80,e.moveZoneContainer.y=i.getPosition().y-80,e.board.addChild(e.moveZoneContainer),e.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.message.can.move",[t.getName()]))}):e.board.contains(e.moveZoneContainer)&&e.board.removeChild(e.moveZoneContainer)}}),[2]})})},t.prototype.resetClock=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return 2!=this.currentHouse.getProgress()?[2]:(null==this.clock&&this.updateClockInStage(this.currentHouse.getClock()),this.clock.isRunning()?this.currentHouse.isGameNewStep()&&this.clock.reset():this.clock.start(),[2])})})},t.prototype.checkBattersInCell=function(e,t,i,a){return __awaiter(this,void 0,void 0,function(){var n,o,s;return __generator(this,function(r){switch(r.label){case 0:return[4,i.filter(function(i){return i.progress==e&&i.step==t&&"attack"==i.evt})];case 1:return n=r.sent(),n.length>0&&(o=a.getBattleTime(),s=(new Date).getTime(),s-o>=3e4&&(a.setBattleTime(s),this.attackTarget(a.getPosition()))),[2]}})})},t.prototype.checkCellItemEffect=function(e,t,i){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(n){return 1==t.getId()&&0==i.getId()&&this.animation({json:"explosion_json",png:"explosion_png",data:"explosion",x:e.x-20,y:e.y-30}).then(function(i){a.board.addChild(i),i.play(1),e.contains(t)&&e.removeChild(t),a.actionSound(RES.getRes("blow_mp3").url),a.actionSound(RES.getRes("destroyhuman_wav").url),setTimeout(function(){a.board.removeChild(i)},1e3)}),[2]})})},t.prototype.kickOff=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return ScatterUtils.getIdentity().then(function(t){return null==t?void e.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.authority")):void ScatterUtils.kickOff(e.currentHouse.getID()).then(function(t){t.processed?(e.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.start.success")),e.clock.start()):(t=JSON.parse(t),e.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.start.fail",[t.error.details[0].message])))})}),[2]})})},t.prototype.updateClockInStage=function(e){this.gameContainer.contains(this.clock)&&this.gameContainer.removeChild(this.clock),this.clock=e,this.clock.x=155,this.clock.y=35,this.gameContainer.addChild(this.clock)},t.prototype.loginGame=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return ScatterUtils.login().then(function(t){t.login?(e.animation({json:"identity_json",png:"identity_png",data:"identity",x:150,y:280}).then(function(i){var a=new egret.Shape;a.graphics.beginFill(4473924,.8),a.graphics.drawRoundRect(0,0,880,880,15,15),a.graphics.endFill(),i.$setScaleX(1.5),i.$setScaleY(1.5),i.play(1),e.board.addChild(a),e.board.addChild(i),egret.setTimeout(function(){e.board.removeChild(i),e.board.removeChild(a),e.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.message.login.success",[t.account]))},e,8e3)}),e.gameContainer.contains(e.login)&&e.gameContainer.removeChild(e.login),e.gameContainer.contains(e.logout)||e.gameContainer.addChild(e.logout),e.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.logout"),e.gameContainer.addChild(e.identityText)):1==t.code?e.popMessageBox(LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.nowallet")):2==t.code&&e.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.wallet.locked",[LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.walletlock"),LocaleUtils.getLabelById(LocaleUtils.locale,"game.wallet.noidentity")]))})["catch"](function(t){console.log("e",t),e.popMessageBox(t)}),[2]})})},t.prototype.logoutGame=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return ScatterUtils.logout().then(function(t){t.logout&&(e.gameContainer.contains(e.logout)&&e.gameContainer.removeChild(e.logout),e.gameContainer.contains(e.login)||e.gameContainer.addChild(e.login),e.popMessageBox(LocaleUtils.getLabelByIdAndValue(LocaleUtils.locale,"game.message.logout.success",[t.account])),e.identityText.text=LocaleUtils.getLabelById(LocaleUtils.locale,"hall.login"),e.gameContainer.addChild(e.identityText))})["catch"](function(t){console.log("e",t),e.popMessageBox(t)}),[2]})})},t.prototype.animation=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(a){return t=new egret.MovieClipDataFactory(RES.getRes(e.json),RES.getRes(e.png)),i=new egret.MovieClip(t.generateMovieClipData(e.data)),i.x=e.x,i.y=e.y,[2,i]})})},t.prototype.showPlayerInfo=function(e){var t=this;this.board.contains(this.playerInfo)&&this.board.removeChild(this.playerInfo),this.playerInfo.graphics.clear(),this.playerInfo.graphics.beginFill(15658734),this.playerInfo.graphics.drawRoundRect(0,0,120,160,15,15),this.playerInfo.graphics.endFill(),this.playerInfo.x=e.x+50,this.playerInfo.y=e.y,this.board.addChild(this.playerInfo),this.player_name.x=this.playerInfo.x,this.player_name.y=this.playerInfo.y,this.player_name.size=18,this.player_name.textColor=0,this.player_name.text="玩家:"+e.getName(),this.board.addChild(this.player_name),this.player_hp.x=this.playerInfo.x,this.player_hp.y=this.playerInfo.y+20,this.player_hp.size=18,this.player_hp.textColor=0,this.player_hp.text="HP: "+e.getLife(),this.board.addChild(this.player_hp),this.player_weapon.x=this.playerInfo.x,this.player_weapon.y=this.playerInfo.y+40,this.player_weapon.size=18,this.player_weapon.textColor=0,this.player_weapon.text="武器: "+ItemUtils.getItemNameById(e.getWeapon(),LocaleUtils.locale),this.board.addChild(this.player_weapon),this.player_attack.x=this.playerInfo.x,this.player_attack.y=this.playerInfo.y+60,this.player_attack.size=18,this.player_attack.textColor=0,this.player_attack.text="攻击力: "+e.getAttack(),this.board.addChild(this.player_attack),this.player_defense.x=this.playerInfo.x,this.player_defense.y=this.playerInfo.y+80,this.player_defense.size=18,this.player_defense.textColor=0,this.player_defense.text="防御力: "+e.getDefense(),this.board.addChild(this.player_defense),this.player_eos.x=this.playerInfo.x,this.player_eos.y=this.playerInfo.y+100,this.player_eos.size=18,this.player_eos.textColor=0,this.player_eos.text="EOS: "+e.getGold(),this.board.addChild(this.player_eos);
var i=function(){var t="";return e.getItems().map(function(e){t=t+ItemUtils.getItemNameById(e,LocaleUtils.locale)+"\n         "}),t};this.player_item.x=this.playerInfo.x,this.player_item.y=this.playerInfo.y+120,this.player_item.size=18,this.player_item.textColor=0,this.player_item.text="物品: "+i(),this.board.addChild(this.player_item),setTimeout(function(){t.board.removeChild(t.playerInfo),t.board.removeChild(t.player_name),t.board.removeChild(t.player_hp),t.board.removeChild(t.player_weapon),t.board.removeChild(t.player_attack),t.board.removeChild(t.player_defense),t.board.removeChild(t.player_eos),t.board.removeChild(t.player_item)},8e3)},t.prototype.recall=function(e){if(e||(e=this.selectedPlayer),e){this.unmountMovement(),this.clearRoute(e.getTask().action);var t=e.getTask().status,i=e.getHouse(),a=i.getPosition(),n=e.getBitmap();egret.Tween.removeTweens(n),t&&"completed"==t?egret.Tween.get(n).to(a,1e3,egret.Ease.sineIn):egret.Tween.get(n).to(a,0,egret.Ease.sineIn),e.setTask({action:"idle",target:null,status:null})}},t.prototype.initTask=function(e){var t=this;this.selectedPlayer?(this.unmountMovement(),this.selectedPlayer.setTask({action:e,target:null,status:null}),setTimeout(function(){t.mountMovement()},300)):console.log("no warrior selected")},t.prototype.showLife=function(e,t){var i,a=t.getLife();i=a.remain>=.6*a.full?60928:a.remain>=.4*a.full&&a.remain<.6*a.full?16776960:16711680,this._life.graphics.clear(),this._life.graphics.lineStyle(4,i),this._life.graphics.moveTo(t.getPosition().x,t.getPosition().y),this._life.graphics.lineTo(t.getPosition().x+a.remain,t.getPosition().y),e.addChild(this._life)},t.prototype.selectSoulder=function(e){this.board.setIndex(e,1),this.actionSound(RES.getRes("yes_mp3").url);var t="玩家: "+e.getName()+"\n"+("HP: "+e.getLife()+"\n")+("武器: "+ItemUtils.getItemNameById(e.getWeapon(),LocaleUtils.locale)+"\n")+("攻击力: "+e.getAttack()+"\n")+("防御力: "+e.getDefense()+"\n")+("EOS: "+e.getGold()+"\n\n");this.popMessageBox(t)},t.prototype.actionSound=function(e){var t=new egret.Sound;t.addEventListener(egret.Event.COMPLETE,function(e){t.play(0,1)},this),t.load(e)},t.prototype.backgroundSound=function(e){this.backgroundMusicChannel&&this.backgroundMusicChannel.stop(),this.backgroundMusic.addEventListener(egret.Event.COMPLETE,this.play,this),this.backgroundMusic.load(e)},t.prototype.play=function(){this.backgroundMusicChannel=this.backgroundMusic.play(0,0)},t.prototype.movePlayer=function(e){if(null!=this.selectedPlayer&&"undefined"!=typeof this.selectedPlayer){this.stage.contains(this._life)&&this.stage.removeChild(this._life);var t=this.selectedPlayer.getBitmap();egret.Tween.removeTweens(t);var i={x:t.x,y:t.y},a={x:e.stageX,y:e.stageY},n=this.selectedPlayer.getTask().action;this.drawRoute(i,a,n);var o={x:e.stageX-17,y:e.stageY-25};egret.Tween.get(t).to(o,3e3,egret.Ease.sineIn).wait(500).call(this.doAction.bind(this,this.selectedPlayer,n,o,a))}},t.prototype.mountMovement=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.movePlayer,this)},t.prototype.unmountMovement=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.movePlayer,this)},t.prototype.doAction=function(e,t,i,a){var n=this;this.clearRoute(t);var o=e.getTask().target,s=null==o||null==o.getBitmap()?!1:o.getBitmap().hitTestPoint(a.x,a.y,!0);if(s){var r=this.createBitmapByName("sword_png");r.x=i.x,r.y=i.y,this.stage.addChild(r),"attack"==t?this.attackTarget(i).then(function(){e.setTask({action:"attack",target:null,status:"completed"}),n.recall(e)}):e.setTask({action:"enforce",target:o,status:"completed"}),setTimeout(function(){n.stage.removeChild(r),r=null},1e3)}else e.setTask({action:"idle",target:null})},t.prototype.attackTarget=function(e){var t=this,i=new egret.MovieClipDataFactory(RES.getRes("fighting_json"),RES.getRes("fighting_png")),a=new egret.MovieClip(i.generateMovieClipData("fighting"));a.x=e.x-20,a.y=e.y-25,this.board.addChild(a),a.play(5),this.actionSound(RES.getRes("shooting_mp3").url);var n=new egret.MovieClipDataFactory(RES.getRes("money_json"),RES.getRes("money_png")),o=new egret.MovieClip(n.generateMovieClipData("money"));return o.x=e.x,o.y=e.y-30,this.board.addChild(o),o.play(2),this.actionSound(RES.getRes("destroyhuman_wav").url),setTimeout(function(){t.board.removeChild(o)},2e3),new Promise(function(e,i){setTimeout(function(){t.board.removeChild(a),t.board.contains(t._life)&&t.board.removeChild(t._life),e()},7e3)})},t.prototype.drawRoute=function(e,t,i){this.clearRoute(i);var a,n,o;switch(i){case"attack":a=16711680,n=25,o=25;break;case"enforce":a=60928,n=10,o=50;break;default:a=16776960,n=10,o=50}this._route.graphics.lineStyle(2,a),this._route.graphics.moveTo(e.x,e.y),this._route.graphics.lineTo(t.x,t.y),this[i].x=t.x-n,this[i].y=t.y-o,this.stage.addChild(this[i])},t.prototype.clearRoute=function(e){this._route.graphics.clear(),this.stage.contains(this[e])&&this.stage.removeChild(this[e]),this.stage.contains(this._life)&&this.stage.removeChild(this._life)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.mouseDown=function(e){null==this.touchPoints[e.touchPointID]&&(this.touchPoints[e.touchPointID]=new egret.Point(e.stageX,e.stageY),this.touchPoints.names.push(e.touchPointID)),this.touchCon++,2==this.touchCon&&(this.distance=this.getTouchDistance())},t.prototype.mouseMove=function(e){if(2==this.touchCon){this.touchPoints[e.touchPointID].x=e.stageX,this.touchPoints[e.touchPointID].y=e.stageY;var t=this.getTouchDistance();this.gameContainer.scaleX=t/this.distance,this.gameContainer.scaleY=this.gameContainer.scaleX}else if(this.mobile){var i=e.stageX-this.touchPoints[e.touchPointID].x,a=e.stageY-this.touchPoints[e.touchPointID].y;this.gameContainer.x=i+this.lastPositionX,this.gameContainer.y=a+this.lastPositionY}},t.prototype.mouseUp=function(e){delete this.touchPoints[e.touchPointID],this.touchCon--,this.lastPositionX=this.gameContainer.x,this.lastPositionY=this.gameContainer.y,this.width*=this.scaleX,this.height*=this.scaleY,this.scaleX=1,this.scaleY=1,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},t.prototype.getTouchDistance=function(){var e=0,t=this.touchPoints.names;return e=egret.Point.distance(this.touchPoints[t[t.length-1]],this.touchPoints[t[t.length-2]])},t.prototype.removePlayerIcon=function(e){var t=this,i=e.getUUID();this.soilderIconList.map(function(e,a){e.key==i&&(t.stage.contains(e.icon)&&t.stage.removeChild(e.icon),t.soilderIconList.splice(a,1))})},t.prototype.refrashPlayerIcon=function(){this.soilderIconList.map(function(e,t){e.icon.x=110+68*t})},t.prototype.startAnimation=function(e){var t=this,i=new egret.HtmlTextParser,a=e.map(function(e){return i.parse(e)}),n=this.textfield,o=-1,s=function(){o++,o>=a.length&&(o=0);var e=a[o];n.textFlow=e;var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(s,t)};s()},t}(egret.DisplayObjectContainer);__reflect(Game.prototype,"Game");var House=function(e){function t(t,i){var a=e.call(this)||this;return a.colorMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],a.game=i,a.createHouse(t),a}return __extends(t,e),t.prototype.createHouse=function(e){this.name=e.name,this.houseBitmap=this.createBitmapByName(e.bitmap),this.houseBitmap.width=150,this.houseBitmap.height=212,this.houseBitmap.touchEnabled=!0,this.addChild(this.houseBitmap),this.touchEnabled=!0,this.id=this.game.game_id,this.joinEos=this.game.join_eos,this.owner=this.game.creator,this.playerList=[],this.createPlayers(this.game.players),this.clock=new Clock},t.prototype.updateHouse=function(e){this.isNewStep=this.game.game_progress!==e.game_progress||this.game.step!==e.step,this.game=e,this.updatePlayers(this.game.players)},t.prototype.updatePlayers=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(i){switch(i.label){case 0:return[4,e.map(function(e){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getPlayerByName(e.acc_name)];case 1:return t=i.sent(),null==t?this.createPlayer(e):(t.updatePlayer(e),2==this.game.game_progress&&this.isNewStep&&t.setMoveable(!0)),[2]}})})})];case 1:return i.sent(),[2]}})})},t.prototype.createPlayers=function(e){var t=this;e.map(function(e){t.createPlayer(e)})},t.prototype.createPlayer=function(e){var t=this.playerList.length%2==0?"avtar_male_png":"avtar_female_png",i=new Player(t,e);this.playerList.push(i)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.getPlayerByName=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.playerList.filter(function(t){return t.getName()==e})];case 1:return t=i.sent(),t.length>0?[2,t[0]]:[2,null]}})})},t.prototype.getPlayerListByCellId=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.playerList.filter(function(t){return t.getCellId()==e})];case 1:return t=i.sent(),[2,t]}})})},t.prototype.getBitmap=function(){return this.houseBitmap},t.prototype.getPlayerList=function(){return this.playerList},t.prototype.getPosition=function(){var e={x:this.x,y:this.y};return e},t.prototype.setPosition=function(e){this.x=e.x,this.y=e.y},t.prototype.destroy=function(){this.houseBitmap=null,this.playerList=[],this.game=null},t.prototype.getID=function(){return this.id},t.prototype.setID=function(e){return this.id=e},t.prototype.getJoinEos=function(){return this.joinEos},t.prototype.getHouseName=function(){return this.name},t.prototype.clearPlayerList=function(){this.playerList=[]},t.prototype.getClock=function(){return this.clock},t.prototype.getBoard=function(){return this.game.board},t.prototype.getProgress=function(){return this.game.game_progress},t.prototype.getStep=function(){return this.game.step},t.prototype.getSafeAreaRadius=function(){return this.game.safe_area_radius},t.prototype.getFullPlayersJsonByCellId=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.game.players.filter(function(t){return t.cell_id==e})];case 1:return t=i.sent(),[2,t]}})})},t.prototype.getPlayerJsonList=function(){return this.game.players},t.prototype.getTotalJoinPlayers=function(){return this.game.total_join_players},t.prototype.getDeadPlayers=function(){return this.game.dead_players},t.prototype.getAlivePlayers=function(){return this.game.total_join_players-this.game.dead_players},t.prototype.getEOSInHouse=function(){return this.getTotalJoinPlayers()*parseFloat(this.getJoinEos().substr(0,6))},t.prototype.getWinner=function(){return this.game.winner},t.prototype.getBestKiller=function(){return this.playerList.sort(function(e,t){return t.getKills()-e.getKills()}),this.playerList[0].getName()},t.prototype.getBestEOSWin=function(){return this.playerList.sort(function(e,t){return t.getGold()-e.getGold()}),this.playerList[0].getName()},t.prototype.getOwner=function(){return this.owner},t.prototype.isGameNewStep=function(){return this.isNewStep},t}(egret.DisplayObjectContainer);__reflect(House.prototype,"House");var Item=function(e){function t(t){var i=e.call(this)||this;return i.createItem(t),i}return __extends(t,e),t.prototype.createItem=function(e){this.itemBitMap=this.createBitmapByName(e),this.itemBitMap.width=50,this.itemBitMap.height=50,this.addChild(this.itemBitMap)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.getBitmap=function(){return this.itemBitMap},t.prototype.getPosition=function(){var e={x:this.x,y:this.y};return e},t.prototype.setPosition=function(e){this.x=e.x,this.y=e.y},t.prototype.getId=function(){return this.id},t.prototype.setId=function(e){this.id=e},t.prototype.destroy=function(){this.itemBitMap=null},t}(egret.DisplayObjectContainer);__reflect(Item.prototype,"Item");var ItemUtils=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.createBitmapById=function(e){var t=new egret.Bitmap,i=RES.getRes(this.items["id_"+e].png);return t.texture=i,t.width=70,t.height=70,t},t.createItemById=function(e){var t=new Item(this.items["id_"+e].png);return t.setId(e),t},t.getItemNameById=function(e,t){var i=this.items["id_"+e][t];return i},t.items={id_0:{zh_CN:"",en_US:"",png:"empty_png"},id_1:{zh_CN:"炸弹",en_US:"Bomb",png:"explosive_png"},id_2:{zh_CN:"",en_US:"",png:"gun4_png"},id_3:{zh_CN:"手枪",en_US:"Pistol",png:"gun1_png"},id_4:{zh_CN:"步枪",en_US:"Rifle",png:"gun2_png"},id_5:{zh_CN:"超级步枪",en_US:"Super Gun",png:"gun4_png"},id_6:{zh_CN:"一级防具",en_US:"Shield Ⅰ",png:"shield1_png"},id_7:{zh_CN:"二级防具",en_US:"Shield Ⅱ",png:"shield2_png"},id_8:{zh_CN:"三级防具",en_US:"Shield Ⅲ",png:"shield3_png"},id_9:{zh_CN:"决斗卡",en_US:"Combat Card",png:"combat_png"},id_10:{zh_CN:"复活卡",en_US:"Rebirth Card",png:"rebirth_png"},id_11:{zh_CN:"药箱",en_US:"Medicine",png:"medicine_png"},id_12:{zh_CN:"急救箱",en_US:"First Aid",png:"first_aid_png"},id_13:{zh_CN:"",en_US:"",png:"money_png"},id_14:{zh_CN:"黄金矿点",en_US:"Gold",png:"gold_png"}},t}(egret.HashObject);__reflect(ItemUtils.prototype,"ItemUtils");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var LocaleUtils=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.getLabelById=function(e,t){var i=this.items[e][t];return i},t.getLabelByIdAndValue=function(e,t,i){var a=this.items[e][t];return i.map(function(e,t){a=a.replace(/\{.\}/,e)}),a},t.locale="zh_CN",t.items={zh_CN:{locale:"中文","hall.login":"  登录","hall.logout":"  登出","hall.login.success":"欢迎：{1}","hall.logout.success":"{1}已登出游戏","hall.game.desc.caption":" 游戏说明","hall.notice.bar.title":"通告栏","hall.notice.failed.create":"创建游戏失败:{1}","hall.notice.cancel.create":"取消创建游戏","hall.game.status.all":" 全部 ","hall.game.status.notstart":"游戏未开始","hall.game.status.joinable":"游戏可加入","hall.game.status.ongoing":"游戏进行中","hall.game.status.over":"游戏已结束","hall.game.room.num":"房号","hall.game.status":"状态:","game.statistic.bar.title":"统计栏","game.message.bar.title":"消息栏","game.grid.bar.title":"格子栏","game.statistic.total.players":"总玩家数:","game.statistic.total.eos":"总EOS数:","game.statistic.survive.players":"生存玩家:","game.message.setmap.success":"棋盘地图设定成功","game.message.can.move":"玩家{1}可以移动","game.message.move.failed":"移动失败","game.message.logout.success":"{1}已登出游戏","game.message.login.success":"欢迎：{1}","game.message.join.success":"加入游戏！","game.message.join.failed":"加入游戏失败:{1}","game.start":"开始游戏","game.start.success":"游戏启动成功！","game.start.fail":"游戏启动失败:{1}","game.honor.bulletin":"荣誉榜","game.honor.winner":"本局赢家：","game.honor.killer":"最佳杀手：","game.honor.eos.winner":"最多EOS赢家：","game.not.found":"无游戏信息","game.player":"玩家:","game.weapon":"武器:","game.force":"攻击力:","game.defence":"防御力:","game.item":"物品:","game.fetch.failure":"获取游戏信息失败","game.wallet.nowallet":"亲，还没有装钱包哟","game.wallet.locked":"未能使用钱包，可能是{1}或者{2}","game.wallet.authority":"未授权用户，请先登录","game.wallet.walletlock":"钱包已上锁","game.wallet.noidentity":"未验证钱包身份","game.item.fall":"{1}即将降落","hall.game.desc":"游戏规则说明：\n1. 进入游戏大厅，点击左上角按钮弹出scatter界面，确认后创建新的一局游戏，新局将出现在游戏大厅中，新局的创建者叫局主；\n\n2. 在游戏大厅中点击新建的游戏，进入游戏界面；\n\n3. 游戏的局主点击左列中间按钮随机出该局的地图道具分布；\n\n4. 之后，其他玩家可以选择地图上的某个格子位置，点击弹出scatter界面，确认后加入游戏，玩家的角色将空降到该地图格子中；\n\n5. 局主可以在参与人数达到2人或2人以上的情况下，随时点击左列“开始游戏”按钮来开局（在设置地图道具后半小时内未开局的情况下系统将自动关闭游戏）；\n\n6. 游戏将以30秒间隔的时间节奏来推进游戏，所有参与玩家可以在30秒内移动一步（或原地不动），30秒后游戏将做出一轮判决，直到判决出游戏的最终胜利者结束；\n\n7. 地图上有毒气圈，每3分钟向内扩大一圈，凡是处于毒气圈内的玩家将会受到伤害；\n\n8. 地图上分布有各类道具，玩家移动进入地图格子时，可以立即拾取枪械或防具，或触发地图事件（如武器空投）；\n\n9. 当同一格子内有多名玩家时，每30秒一轮的判决将会让玩家相互攻击；\n\n10. 当有一半玩家阵亡时，地图上将会在某个格子上空投EOS（空投发生时，该格子上的玩家将被全部杀死）；\n\n11. 击杀其他玩家，可获得被击杀玩家身上一定比例的EOS，以及额外的击杀奖励；\n\n12. 击杀数最高的玩家，将会获得“杀手”的奖励，游戏的最后一名玩家，将会获得“胜利者”的奖励\n\n另外，关于scatter钱包的设置，请参考：\n1. https://get-scatter.com\n2. https://chrome.google.com/webstore/detail/scatter/ammjpmhgckkpcamddpolhchgomcojkle"},en_US:{locale:"ENG","hall.login":" Login","hall.logout":"Logout","hall.login.success":"Welcome：{1}","hall.logout.success":"{1} has logged out of the game","hall.game.desc.caption":"Instructions","hall.notice.bar.title":"Notice","hall.notice.cancel.create":"Cancelled creating a game","hall.game.status.all":"   All ","hall.game.status.notstart":"Not Start","hall.game.status.joinable":"  Can join","hall.game.status.ongoing":"  In game","hall.game.status.over":"GameOver","hall.game.room.num":"Rm.","hall.game.status":"Status:","game.statistic.bar.title":"Statistics","game.message.bar.title":"Message","game.grid.bar.title":"Grids","game.statistic.total.players":"Total players:","game.statistic.total.eos":"Total EOS:","game.statistic.survive.players":"Total survival players:","game.message.setmap.success":"The board map is set successfully","game.message.can.move":"Player {1} can move","game.message.move.failed":"Fail to move","game.message.logout.success":"{1} has logged out of the game","game.message.login.success":"Welcome: {1}","game.message.join.success":"Joined the game!","game.message.join.failed":"Joined the game failed:{1}","game.start":"  Start","game.start.success":"The game started successfully!","game.start.fail":"The game started failed:{1}","game.honor.bulletin":"Honor","game.honor.winner":"Winner:","game.honor.killer":"Best killer:","game.honor.eos.winner":"EOS winners:","game.not.found":"Game not found","game.player":"Player:","game.weapon":"Weapon:","game.force":"Force:","game.defence":"Defence:","game.item":"Items:","game.fetch.failure":"Fail to get game","game.wallet.nowallet":"Scatter wallet has not been installed","game.wallet.locked":"Cannot use wallet，probably {1} or {2}","game.wallet.authority":"Unauthenticated user, please login first","game.wallet.walletlock":"Scatter is locked","game.wallet.noidentity":"Scatter unidentified","game.item.fall":"{1} will fall","hall.game.desc":"Game rules description:\n\n1. Enter the game lobby, click the button in the upper left corner to pop up the scatter interface, confirm to create a new game, the new game will appear in the game hall, the creator of the new game is called the game host;\n2. Click on the newly created game in the game lobby to enter the game;\n3. The game host clicks on the middle button in the left column to randomly distribute the map props of the game;\n4. After that, other players can select a grid position on the map. Click to pop up the scatter interface, confirm and join the game, the player's character will be airborne to the map grid;\n5. The host can click the 'Kickoff' button to start the game at any time in the case of 2 or more participants (the system will automatically close the game if it is not kicked off within half an hour after setting the game map);\n6. The system will advance the game at a time interval of 30 seconds, and all participating players can move one step in 30 seconds (Or not moving), after 30 seconds, the game will make a round of judgment until the final winner of the game is judged;\n7. There is a poisonous air circle on the map, which expands inward every 3 minutes. All players in the poisonous gas circle will be hurt;\n8. There are various kinds of props on the map. When the player moves into one map grid, he can immediately pick up firearms or armor, or trigger map events (such as weapon airdrops) in the grid;\n9. When there are multiple players in the same grid, a round of judgment every 30 seconds will force players to attack each other;\n10. When half of the players are killed, the system will cast EOS on a map grid (When airdrop occurs, players on the grid will be killed all the time);\n11. Killing other players will get a certain percentage of EOS on the slain, as well as additional killing rewards;\n12. Kill the highest number of players, will get the 'killer' reward, the last player of the game, will receive the 'winner' reward\n\nIn addition, regarding the setting of the scatter wallet, please refer to:\n1. https://get-scatter. Com\n2. https://chrome.google.com/webstore/detail/scatter/ammjpmhgckkpcamddpolhchgomcojkle"}},t}(egret.HashObject);__reflect(LocaleUtils.prototype,"LocaleUtils");var Cell=function(e){function t(t,i,a){var n=e.call(this)||this;return n.cellRect=new egret.Shape,n.task={action:"idle",target:null,status:null},n.position=new egret.Point(0,0),n.item=null,n.hasPoison=!1,n.battleTime=0,n.fallDownSign=!1,n.createCell(t,i,a),n}return __extends(t,e),t.prototype.createCell=function(e,t,i){this.id=i,this.detailBitmap=this.createBitmapByName("show_png"),this.detailBitmap.$setVisible(!1),this.addChild(this.detailBitmap),this.cellRect.graphics.clear(),this.cellRect.graphics.lineStyle(1,0,.3),this.cellRect.graphics.beginFill(16240036,.2),this.cellRect.graphics.drawRect(0,0,80,80),this.cellRect.graphics.endFill(),this.addChild(this.cellRect),this.position=new egret.Point(80*e,80*t),this.x=this.position.x,this.y=this.position.y,this.cell_X_Y={x:e,y:t},this.touchEnabled=!0},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.getBitmap=function(){return this.cellBitmap},t.prototype.setTask=function(e){this.task=e},t.prototype.getTask=function(){return this.task},t.prototype.getPosition=function(){var e={x:this.x,y:this.y};return e},t.prototype.setPosition=function(e){this.x=e.x,this.y=e.y},t.prototype.destroy=function(){this.cellBitmap=null},t.prototype.getID=function(){return this.id},t.prototype.getXY=function(){return this.cell_X_Y},t.prototype.getItem=function(){return this.item},t.prototype.setItem=function(e){this.item=e},t.prototype.addItem=function(e){this.contains(this.item)&&(this.item.destroy(),this.removeChild(this.item)),this.item=e,this.addChild(this.item)},t.prototype.addPoison=function(e){this.hasPoison=!0,this.addChild(e)},t.prototype.getPoison=function(){return this.hasPoison},t.prototype.setBattleTime=function(e){this.battleTime=e},t.prototype.getBattleTime=function(){return this.battleTime},t.prototype.setIndex=function(e,t){this.setChildIndex(e,t)},t.prototype.hideDetailMode=function(){this.detailBitmap.$setVisible(!1)},t.prototype.showDetailMode=function(e){this.detailBitmap.$setVisible(e)},t.prototype.onDetailMode=function(){return this.detailBitmap.visible},t.prototype.hasFallDownSign=function(){return this.fallDownSign},t.prototype.addFallDownSign=function(e){this.fallDownSign=e},t}(egret.DisplayObjectContainer);__reflect(Cell.prototype,"Cell");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var Player=function(e){function t(t,i){var a=e.call(this)||this;return a.task={action:"idle",target:null,status:null},a.position=new egret.Point(0,0),a.items=[],a.createPlayer(t,i),a}return __extends(t,e),t.prototype.createPlayer=function(e,t){this.playerBitmap=this.createBitmapByName(e),this.playerBitmap.width=70,this.playerBitmap.height=70,this.playerProfile=this.createBitmapByName("profile_"+e),e.indexOf("female")>=0?this.setGentle(1):this.setGentle(0),this.addChild(this.playerBitmap),this.setName(t.acc_name),this.setCellId(t.cell_id),this.setArmor(t.armor),this.setAttack(t.attack),this.setLife(t.hp),this.setDefense(t.defense),this.setItems(t.items),this.setWeapon(t.weapon),this.setGold(t.win_eos),this.setKills(t.kill_count)},t.prototype.updatePlayer=function(e){this.setCellId(e.cell_id),this.setArmor(e.armor),this.setAttack(e.attack),this.setLife(e.hp),this.setDefense(e.defense),this.setItems(e.items),this.setWeapon(e.weapon),this.setGold(e.win_eos),this.setKills(e.kill_count)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.getBitmap=function(){return this.playerBitmap},t.prototype.getPlayerProfile=function(){return this.playerProfile},t.prototype.setTask=function(e){this.task=e},t.prototype.getTask=function(){return this.task},t.prototype.getHouse=function(){return this.house},t.prototype.getPosition=function(){var e={x:this.x,y:this.y};return e},t.prototype.setPosition=function(e){this.x=e.x,this.y=e.y},t.prototype.getName=function(){return this.accName},t.prototype.setName=function(e){this.accName=e},t.prototype.getLife=function(){return this.hp},t.prototype.setLife=function(e){this.hp=e},t.prototype.destroy=function(){this.playerBitmap=null},t.prototype.getUUID=function(){return this.uuid},t.prototype.getGold=function(){return this.gold},t.prototype.setGold=function(e){this.gold=e},t.prototype.getCellId=function(){return this.cell_id},t.prototype.setCellId=function(e){this.cell_id=e},t.prototype.getArmor=function(){return this.armor},t.prototype.setArmor=function(e){this.armor=e},t.prototype.getAttack=function(){return this.attack},t.prototype.setAttack=function(e){this.attack=e},t.prototype.getDefense=function(){return this.defense},t.prototype.setDefense=function(e){this.defense=e},t.prototype.getWeapon=function(){return this.weapon},t.prototype.setWeapon=function(e){this.weapon=e},t.prototype.getItems=function(){return this.items},t.prototype.setItems=function(e){this.items=e},t.prototype.isAlive=function(){return this.getLife()>0?!0:!1},t.prototype.getKills=function(){return this.kills},t.prototype.setKills=function(e){this.kills=e},t.prototype.setMoveable=function(e){this.moveable=e},t.prototype.isMoveable=function(){return this.moveable},t.prototype.setGentle=function(e){this.gentle=e},t.prototype.getGentle=function(){return this.gentle},t}(egret.DisplayObjectContainer);__reflect(Player.prototype,"Player");var ScatterUtils=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.getEOS=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return null==this.eos?[2,Eos(this.config)]:[2,this.eos]})})},t.connect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this,[4,ScatterJS.scatter.connect("scatter")];case 1:return e.connected=t.sent(),[2,this.connected]}})})},t.login=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i=this;return __generator(this,function(a){switch(a.label){case 0:return[4,this.connect()];case 1:if(a.sent(),!this.connected)return[2,{login:!1,code:1}];a.label=2;case 2:return a.trys.push([2,4,,5]),[4,ScatterJS.scatter.getIdentity({accounts:[this.network.EOS]}).then(function(e){return i.currentAccount=e.accounts[0],i.eos=ScatterJS.scatter.eos(i.network.EOS,Eos),{login:!0,account:i.currentAccount.name}})];case 3:return e=a.sent(),[2,e];case 4:return t=a.sent(),[2,{login:!1,code:2}];case 5:return[2]}})})},t.getAccountInfo=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return null!=this.eos?[3,2]:(e=this,[4,this.getEOS()]);case 1:e.eos=i.sent(),i.label=2;case 2:return[4,this.eos.getAccount(this.currentAccount.name).then(function(e){return e})["catch"](function(e){return e})];case 3:return t=i.sent(),[2,t]}})})},t.getAllGamesInfo=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return null!=this.eos?[3,2]:(e=this,[4,this.getEOS()]);case 1:e.eos=i.sent(),i.label=2;case 2:return[4,this.eos.getTableRows({json:!0,scope:this.contact.jungle,code:this.contact.jungle,table:"games"}).then(function(e){return e})["catch"](function(e){return e})];case 3:return t=i.sent(),[2,t]}})})},t.getGameInfo=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(a){switch(a.label){case 0:return null!=this.eos?[3,2]:(t=this,[4,this.getEOS()]);case 1:t.eos=a.sent(),a.label=2;case 2:return[4,this.eos.getTableRows({json:!0,scope:this.contact.jungle,code:this.contact.jungle,table:"games",limit:1,lower_bound:e,upper_bound:e+1}).then(function(e){return e})["catch"](function(e){return e})];case 3:return i=a.sent(),[2,i]}})})},t.createGame=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.eos.transaction({actions:[{account:"eosio.token",name:"transfer",authorization:[{actor:this.currentAccount.name,permission:"active"}],data:{from:this.currentAccount.name,to:this.contact.jungle,quantity:e,memo:""}}]}).then(function(e){return e})["catch"](function(e){return e})];case 1:return t=i.sent(),[2,t]}})})},t.joinGame=function(e,t,i,a){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(o){switch(o.label){case 0:return[4,this.eos.transaction({actions:[{account:"eosio.token",name:"transfer",authorization:[{actor:this.currentAccount.name,permission:"active"}],data:{from:this.currentAccount.name,to:this.contact.jungle,quantity:t,memo:e+","+i+","+a}}]}).then(function(e){return e})["catch"](function(e){return e})];case 1:return n=o.sent(),[2,n]}})})},t.setMap=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,fetch("http://114.115.135.201:52919/api?a=setmap&game_id="+e,{method:"GET"}).then(function(e){return e.json()}).then(function(e){return e})];case 1:return t=i.sent(),[2,t]}})})},t.kickOff=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.eos.transaction({actions:[{account:this.contact.jungle,name:"kickoff",authorization:[{actor:this.currentAccount.name,permission:"active"}],data:{who:this.currentAccount.name,game_id:e}}]}).then(function(e){return e})["catch"](function(e){return e})];case 1:return t=i.sent(),[2,t]}})})},t.move=function(e,t,i){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(n){switch(n.label){case 0:return[4,this.eos.transaction({actions:[{account:this.contact.jungle,name:"move",authorization:[{actor:this.currentAccount.name,permission:"active"}],data:{who:this.currentAccount.name,game_id:e,row:t,column:i}}]}).then(function(e){return e})["catch"](function(e){return e})];case 1:return a=n.sent(),[2,a]}})})},t.logout=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){e=this.currentAccount.name;try{return ScatterJS.scatter.forgetIdentity(),this.currentAccount=null,this.eos=null,[2,{logout:!0,account:e}]}catch(i){return console.log(i),[2,{logout:!1,account:e}]}return[2]})})},t.getCurrentAccountName=function(){return null!=this.currentAccount?this.currentAccount.name:null},t.getIdentity=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,ScatterJS.scatter.identity]})})},t.nowseconds=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,fetch("http://114.115.135.201:52920/api/?a=now",{method:"GET"}).then(function(e){return e.json()}).then(function(e){return e})];case 1:return e=t.sent(),[2,e]}})})},t.eos=null,t.connected=!1,t.currentAccount=null,t.message={authority:"未授权用户，请先登录",walletlock:"钱包已上锁",noidentity:"未验证钱包身份",nowallet:"亲，还没有装钱包哟",login:"已登陆游戏",logout:"已登出游戏"},t.chain={main:"aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906",jungle:"e70aaab8997e1dfce58fbfac80cbbb8fecec7b99cf982a9444273cbc64c41473",dev:"cf057bbfb72640471fd910bcb67639c22df9f92470936cddc1ade0e2f2e7dc4f"},t.Blockchains={EOSIO:"eos",Ethereum:"eth",Tron:"trx"},t.contact={jungle:"eat1chicken2"},t.network={EOS:{blockchain:"eos",protocol:"https",host:"eos-jungle.eosblocksmith.io",port:443,chainId:t.chain.jungle},ETH:{blockchain:"eth",protocol:"http",host:"114.115.135.201",port:8888,chainId:t.chain.dev},TRX:{blockchain:"trx",protocol:"http",host:"114.115.135.201",port:8888,chainId:t.chain.dev}},t.config={keyProvider:["5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3","5KRF8dr2fvHx9dVQyBqWwYhs7KvT8UdCb8Fy6hpWqHp6yZ1K6T3"],httpEndpoint:"https://eos-jungle.eosblocksmith.io:443",chainId:t.chain.jungle,expireInSeconds:60,broadcast:!0,debug:!1,sign:!0},t
}(Object);__reflect(ScatterUtils.prototype,"ScatterUtils");var Clock=function(e){function t(){var t=e.call(this)||this;return t.stageW=50,t.stageH=50,t.createMin=(new Date).getMinutes(),t.createHour=(new Date).getHours(),t.gameTime=new Date(2018,1,1,0,0,0),t.interval=-1,t.createClock(),t}return __extends(t,e),t.prototype.createClock=function(){this.pan=new Pan(this.stageW),this.pan.x=this.stageW/2,this.pan.y=this.stageH/2,this.addChild(this.pan),this.SecPointer=new SecPointer,this.SecPointer.x=this.stageW/2,this.SecPointer.y=this.stageH/2,this.addChild(this.SecPointer),this.SecPointer.initSec(this.stageW/2,this.gameTime)},t.prototype.drawPointer=function(){this.gameTime=new Date(this.gameTime.getTime()+1e3),this.SecPointer.initSec(this.stageW-10,this.gameTime)},t.prototype.start=function(){egret.clearInterval(this.interval),this.interval=egret.setInterval(this.drawPointer,this,1e3)},t.prototype.reset=function(){this.gameTime=new Date(2018,1,1,0,0,0)},t.prototype.isRunning=function(){return-1==this.interval?!1:!0},t}(egret.DisplayObjectContainer);__reflect(Clock.prototype,"Clock");var HourPointer=function(e){function t(){var t=e.call(this)||this;return t.myHour=new egret.Shape,t.addChild(t.myHour),t}return __extends(t,e),t.prototype.initHour=function(e,t){var i=t.getHours();i=i>12?i-12:i,this.myHour.graphics.clear(),this.myHour.graphics.lineStyle(8,15597568),this.myHour.graphics.moveTo(0,0),this.myHour.graphics.lineTo(0,-e),this.myHour.anchorOffsetY=0,this.myHour.anchorOffsetX=0,this.myHour.rotation=30*i,this.myHour.graphics.endFill()},t}(egret.Sprite);__reflect(HourPointer.prototype,"HourPointer");var MinPointer=function(e){function t(){var t=e.call(this)||this;return t.myMin=new egret.Shape,t.addChild(t.myMin),t}return __extends(t,e),t.prototype.initMin=function(e,t){this.myMin.graphics.clear(),this.myMin.graphics.lineStyle(6,255),this.myMin.graphics.moveTo(0,0),this.myMin.graphics.lineTo(0,-e),this.myMin.anchorOffsetY=0,this.myMin.anchorOffsetX=0,this.myMin.rotation=6*t.getMinutes(),this.myMin.graphics.endFill()},t}(egret.Sprite);__reflect(MinPointer.prototype,"MinPointer");var Pan=function(e){function t(t){var i=e.call(this)||this;return i.Init(t),i}return __extends(t,e),t.prototype.Init=function(e){this.initCircle(e),this.initScale(e)},t.prototype.initCircle=function(e){this.mypan=new egret.Shape,this.mypan.graphics.beginFill(16249568),this.mypan.graphics.drawCircle(0,0,e),this.mypan.graphics.endFill(),this.addChild(this.mypan)},t.prototype.initScale=function(e){for(var t=0;60>t;t++)this.myscale1=new egret.Shape,this.myscale1.graphics.lineStyle(2,0),this.myscale1.graphics.moveTo(0,0),this.myscale1.graphics.lineTo(0,5),this.myscale1.graphics.endFill(),this.myscale1.anchorOffsetY=e,this.myscale1.rotation=6*t,this.addChild(this.myscale1);for(var i=0;12>i;i++)this.myscale2=new egret.Shape,this.myscale2.graphics.lineStyle(4,0),this.myscale2.graphics.moveTo(0,0),this.myscale2.graphics.lineTo(0,10),this.myscale2.graphics.endFill(),this.myscale2.anchorOffsetY=e,this.myscale2.rotation=30*i,this.addChild(this.myscale2)},t}(egret.Sprite);__reflect(Pan.prototype,"Pan");var SecPointer=function(e){function t(){var t=e.call(this)||this;return t.mySec=new egret.Shape,t.addChild(t.mySec),t}return __extends(t,e),t.prototype.initSec=function(e,t){this.mySec.graphics.clear(),this.mySec.graphics.lineStyle(4,16711680),this.mySec.graphics.moveTo(0,0),this.mySec.graphics.lineTo(0,-e),this.mySec.anchorOffsetY=0,this.mySec.anchorOffsetX=0,this.mySec.rotation=6*t.getSeconds(),this.mySec.graphics.endFill()},t}(egret.Sprite);__reflect(SecPointer.prototype,"SecPointer");